import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as m,p as Y,c as j,o as p,b as T,d as t,w as a,f as s,E as i,q as G,h as r,s as K,l as b,t as h,F as Q,v as R,z as W}from"./index-BThRipZj.js";const X={class:"page"},Z={class:"page-header"},ee={__name:"Announcements",setup(te){const $=m(!1),S=m([]),x=m([]),_=m(!1),v=m(!1),C=m(!1),o=m({title:"",content:"",priority:"medium",link_event_id:null}),y=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,A=n=>{if(!n)return"";const e=new Date(n),u=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),g=String(e.getMinutes()).padStart(2,"0");return`${u}-${f}-${d} ${c}:${g}`},w=async()=>{$.value=!0;try{const e=await(await fetch(`/api/admin/announcements?user_id=${y()}`)).json();e.success&&(S.value=e.data||[])}catch(n){console.error("加载公告失败:",n),i.error("加载失败")}finally{$.value=!1}},N=async()=>{try{const e=await(await fetch(`/api/admin/events?user_id=${y()}`)).json();e.success&&(x.value=e.data||[])}catch(n){console.error("加载赛事失败:",n)}},B=()=>{v.value=!1,o.value={title:"",content:"",priority:"medium",link_event_id:null},_.value=!0},M=n=>{v.value=!0,o.value={...n},_.value=!0},P=async()=>{if(!o.value.title||!o.value.content){i.warning("请填写标题和内容");return}C.value=!0;try{const n=v.value?`/api/admin/announcements/${o.value.id}`:"/api/admin/announcements",e=v.value?"PUT":"POST",f=await(await fetch(n,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({...o.value,user_id:y()})})).json();f.success?(i.success(v.value?"更新成功":"发布成功"),_.value=!1,w()):i.error(f.message||"操作失败")}catch(n){console.error("提交失败:",n),i.error("操作失败")}finally{C.value=!1}},z=async n=>{try{const u=await(await fetch(`/api/admin/announcements/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,is_active:n.is_active?0:1,user_id:y()})})).json();u.success?(i.success("状态已更新"),w()):i.error(u.message||"操作失败")}catch(e){console.error("更新失败:",e),i.error("操作失败")}},F=async n=>{try{await W.confirm("确定要删除这条公告吗？","提示",{type:"warning"});const u=await(await fetch(`/api/admin/announcements/${n.id}?user_id=${y()}`,{method:"DELETE"})).json();u.success?(i.success("删除成功"),w()):i.error(u.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),i.error("删除失败"))}};return Y(()=>{w(),N()}),(n,e)=>{const u=s("Plus"),f=s("el-icon"),d=s("el-button"),c=s("el-table-column"),g=s("el-tag"),I=s("el-table"),O=s("el-card"),D=s("el-input"),k=s("el-form-item"),V=s("el-option"),E=s("el-select"),q=s("el-form"),J=s("el-dialog"),L=G("loading");return p(),j("div",X,[T("div",Z,[e[7]||(e[7]=T("h2",null,"公告管理",-1)),t(d,{type:"primary",onClick:B},{default:a(()=>[t(f,null,{default:a(()=>[t(u)]),_:1}),e[6]||(e[6]=r(" 发布公告 ",-1))]),_:1})]),t(O,null,{default:a(()=>[K((p(),b(I,{data:S.value,stripe:""},{default:a(()=>[t(c,{prop:"id",label:"ID",width:"60"}),t(c,{prop:"title",label:"标题","min-width":"200"}),t(c,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[l.priority==="high"?(p(),b(g,{key:0,type:"danger"},{default:a(()=>[...e[8]||(e[8]=[r("高",-1)])]),_:1})):l.priority==="medium"?(p(),b(g,{key:1,type:"warning"},{default:a(()=>[...e[9]||(e[9]=[r("中",-1)])]),_:1})):(p(),b(g,{key:2,type:"info"},{default:a(()=>[...e[10]||(e[10]=[r("低",-1)])]),_:1}))]),_:1}),t(c,{prop:"is_active",label:"状态",width:"80"},{default:a(({row:l})=>[t(g,{type:l.is_active?"success":"info"},{default:a(()=>[r(h(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:l})=>[r(h(A(l.created_at)),1)]),_:1}),t(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(d,{size:"small",onClick:U=>M(l)},{default:a(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:l.is_active?"warning":"success",onClick:U=>z(l)},{default:a(()=>[r(h(l.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(d,{size:"small",type:"danger",onClick:U=>F(l)},{default:a(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,$.value]])]),_:1}),t(J,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value=l),title:v.value?"编辑公告":"发布公告",width:"600px"},{footer:a(()=>[t(d,{onClick:e[4]||(e[4]=l=>_.value=!1)},{default:a(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:P,loading:C.value},{default:a(()=>[...e[14]||(e[14]=[r("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(q,{model:o.value,"label-width":"80px"},{default:a(()=>[t(k,{label:"标题",required:""},{default:a(()=>[t(D,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.title=l),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"内容",required:""},{default:a(()=>[t(D,{modelValue:o.value.content,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.content=l),type:"textarea",rows:5,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),t(k,{label:"优先级"},{default:a(()=>[t(E,{modelValue:o.value.priority,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.priority=l)},{default:a(()=>[t(V,{label:"高",value:"high"}),t(V,{label:"中",value:"medium"}),t(V,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"关联赛事"},{default:a(()=>[t(E,{modelValue:o.value.link_event_id,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.link_event_id=l),clearable:"",placeholder:"可选"},{default:a(()=>[(p(!0),j(Q,null,R(x.value,l=>(p(),b(V,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=H(ee,[["__scopeId","data-v-02827720"]]);export{ne as default};
