import{a as f}from"./index-B9ygI19o.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as u,n as K,c as U,o as d,b as h,d as t,w as a,f as s,E as i,p as O,h as r,q as Q,l as y,t as q,F as R,s as W,y as X}from"./index-Cf1Abx-S.js";const Y={class:"page"},Z={class:"page-header"},_="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",ee={__name:"Announcements",setup(te){const $=u(!1),C=u([]),A=u([]),c=u(!1),m=u(!1),x=u(!1),o=u({title:"",content:"",priority:"medium",link_event_id:null}),g=async()=>{$.value=!0;try{const n=await f.get(`${_}/api/admin/announcements`);n.data.success&&(C.value=n.data.data.list||n.data.data)}catch(n){console.error("加载公告失败:",n),i.error("加载失败")}finally{$.value=!1}},z=async()=>{try{const n=await f.get(`${_}/api/events`);n.data.success&&(A.value=n.data.data.list||n.data.data)}catch(n){console.error("加载赛事失败:",n)}},F=()=>{m.value=!1,o.value={title:"",content:"",priority:"medium",link_event_id:null},c.value=!0},I=n=>{m.value=!0,o.value={...n},c.value=!0},M=async()=>{if(!o.value.title||!o.value.content){i.warning("请填写标题和内容");return}x.value=!0;try{const n=m.value?`${_}/api/admin/announcements/${o.value.id}`:`${_}/api/admin/announcements`,e=m.value?"put":"post",b=await f[e](n,o.value);b.data.success?(i.success(m.value?"更新成功":"发布成功"),c.value=!1,g()):i.error(b.data.message||"操作失败")}catch(n){console.error("提交失败:",n),i.error("操作失败")}finally{x.value=!1}},N=async n=>{try{const e=await f.put(`${_}/api/admin/announcements/${n.id}`,{is_active:!n.is_active});e.data.success?(i.success("状态已更新"),g()):i.error(e.data.message||"操作失败")}catch(e){console.error("更新失败:",e),i.error("操作失败")}},P=async n=>{try{await X.confirm("确定要删除这条公告吗？","提示",{type:"warning"});const e=await f.delete(`${_}/api/admin/announcements/${n.id}`);e.data.success?(i.success("删除成功"),g()):i.error(e.data.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),i.error("删除失败"))}};return K(()=>{g(),z()}),(n,e)=>{const b=s("Plus"),S=s("el-icon"),p=s("el-button"),v=s("el-table-column"),k=s("el-tag"),L=s("el-table"),T=s("el-card"),E=s("el-input"),V=s("el-form-item"),w=s("el-option"),B=s("el-select"),j=s("el-form"),G=s("el-dialog"),H=O("loading");return d(),U("div",Y,[h("div",Z,[e[7]||(e[7]=h("h2",null,"公告管理",-1)),t(p,{type:"primary",onClick:F},{default:a(()=>[t(S,null,{default:a(()=>[t(b)]),_:1}),e[6]||(e[6]=r(" 发布公告 ",-1))]),_:1})]),t(T,null,{default:a(()=>[Q((d(),y(L,{data:C.value,stripe:""},{default:a(()=>[t(v,{prop:"id",label:"ID",width:"60"}),t(v,{prop:"title",label:"标题","min-width":"200"}),t(v,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[l.priority==="high"?(d(),y(k,{key:0,type:"danger"},{default:a(()=>[...e[8]||(e[8]=[r("高",-1)])]),_:1})):l.priority==="medium"?(d(),y(k,{key:1,type:"warning"},{default:a(()=>[...e[9]||(e[9]=[r("中",-1)])]),_:1})):(d(),y(k,{key:2,type:"info"},{default:a(()=>[...e[10]||(e[10]=[r("低",-1)])]),_:1}))]),_:1}),t(v,{prop:"is_active",label:"状态",width:"80"},{default:a(({row:l})=>[t(k,{type:l.is_active?"success":"info"},{default:a(()=>[r(q(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"created_at",label:"创建时间",width:"160"}),t(v,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(p,{size:"small",onClick:D=>I(l)},{default:a(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(p,{size:"small",type:l.is_active?"warning":"success",onClick:D=>N(l)},{default:a(()=>[r(q(l.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(p,{size:"small",type:"danger",onClick:D=>P(l)},{default:a(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,$.value]])]),_:1}),t(G,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value=l),title:m.value?"编辑公告":"发布公告",width:"600px"},{footer:a(()=>[t(p,{onClick:e[4]||(e[4]=l=>c.value=!1)},{default:a(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:M,loading:x.value},{default:a(()=>[...e[14]||(e[14]=[r("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(j,{model:o.value,"label-width":"80px"},{default:a(()=>[t(V,{label:"标题",required:""},{default:a(()=>[t(E,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.title=l),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(V,{label:"内容",required:""},{default:a(()=>[t(E,{modelValue:o.value.content,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.content=l),type:"textarea",rows:5,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),t(V,{label:"优先级"},{default:a(()=>[t(B,{modelValue:o.value.priority,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.priority=l)},{default:a(()=>[t(w,{label:"高",value:"high"}),t(w,{label:"中",value:"medium"}),t(w,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"关联赛事"},{default:a(()=>[t(B,{modelValue:o.value.link_event_id,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.link_event_id=l),clearable:"",placeholder:"可选"},{default:a(()=>[(d(!0),U(R,null,W(A.value,l=>(d(),y(w,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=J(ee,[["__scopeId","data-v-70fa43ae"]]);export{oe as default};
