import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,p as G,c as T,o as c,b as A,d as t,w as a,f as s,E as i,q as H,h as r,s as K,l as y,t as D,F as Q,v as R,z as W}from"./index-B_huGCKR.js";const X={class:"page"},Y={class:"page-header"},Z={__name:"Announcements",setup(ee){const C=d(!1),x=d([]),$=d([]),m=d(!1),p=d(!1),h=d(!1),o=d({title:"",content:"",priority:"medium",link_event_id:null}),f=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,g=async()=>{C.value=!0;try{const e=await(await fetch(`/api/admin/announcements?user_id=${f()}`)).json();e.success&&(x.value=e.data||[])}catch(n){console.error("加载公告失败:",n),i.error("加载失败")}finally{C.value=!1}},N=async()=>{try{const e=await(await fetch(`/api/admin/events?user_id=${f()}`)).json();e.success&&($.value=e.data||[])}catch(n){console.error("加载赛事失败:",n)}},S=()=>{p.value=!1,o.value={title:"",content:"",priority:"medium",link_event_id:null},m.value=!0},B=n=>{p.value=!0,o.value={...n},m.value=!0},P=async()=>{if(!o.value.title||!o.value.content){i.warning("请填写标题和内容");return}h.value=!0;try{const n=p.value?`/api/admin/announcements/${o.value.id}`:"/api/admin/announcements",e=p.value?"PUT":"POST",b=await(await fetch(n,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({...o.value,user_id:f()})})).json();b.success?(i.success(p.value?"更新成功":"发布成功"),m.value=!1,g()):i.error(b.message||"操作失败")}catch(n){console.error("提交失败:",n),i.error("操作失败")}finally{h.value=!1}},z=async n=>{try{const u=await(await fetch(`/api/admin/announcements/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,status:n.status==="active"?"inactive":"active",user_id:f()})})).json();u.success?(i.success("状态已更新"),g()):i.error(u.message||"操作失败")}catch(e){console.error("更新失败:",e),i.error("操作失败")}},I=async n=>{try{await W.confirm("确定要删除这条公告吗？","提示",{type:"warning"});const u=await(await fetch(`/api/admin/announcements/${n.id}?user_id=${f()}`,{method:"DELETE"})).json();u.success?(i.success("删除成功"),g()):i.error(u.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),i.error("删除失败"))}};return G(()=>{g(),N()}),(n,e)=>{const u=s("Plus"),b=s("el-icon"),_=s("el-button"),v=s("el-table-column"),w=s("el-tag"),O=s("el-table"),q=s("el-card"),E=s("el-input"),k=s("el-form-item"),V=s("el-option"),U=s("el-select"),F=s("el-form"),J=s("el-dialog"),M=H("loading");return c(),T("div",X,[A("div",Y,[e[7]||(e[7]=A("h2",null,"公告管理",-1)),t(_,{type:"primary",onClick:S},{default:a(()=>[t(b,null,{default:a(()=>[t(u)]),_:1}),e[6]||(e[6]=r(" 发布公告 ",-1))]),_:1})]),t(q,null,{default:a(()=>[K((c(),y(O,{data:x.value,stripe:""},{default:a(()=>[t(v,{prop:"id",label:"ID",width:"60"}),t(v,{prop:"title",label:"标题","min-width":"200"}),t(v,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[l.priority==="high"?(c(),y(w,{key:0,type:"danger"},{default:a(()=>[...e[8]||(e[8]=[r("高",-1)])]),_:1})):l.priority==="medium"?(c(),y(w,{key:1,type:"warning"},{default:a(()=>[...e[9]||(e[9]=[r("中",-1)])]),_:1})):(c(),y(w,{key:2,type:"info"},{default:a(()=>[...e[10]||(e[10]=[r("低",-1)])]),_:1}))]),_:1}),t(v,{prop:"is_active",label:"状态",width:"80"},{default:a(({row:l})=>[t(w,{type:l.is_active?"success":"info"},{default:a(()=>[r(D(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"created_at",label:"创建时间",width:"160"}),t(v,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(_,{size:"small",onClick:j=>B(l)},{default:a(()=>[...e[11]||(e[11]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(_,{size:"small",type:l.is_active?"warning":"success",onClick:j=>z(l)},{default:a(()=>[r(D(l.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(_,{size:"small",type:"danger",onClick:j=>I(l)},{default:a(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[M,C.value]])]),_:1}),t(J,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value=l),title:p.value?"编辑公告":"发布公告",width:"600px"},{footer:a(()=>[t(_,{onClick:e[4]||(e[4]=l=>m.value=!1)},{default:a(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:P,loading:h.value},{default:a(()=>[...e[14]||(e[14]=[r("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(F,{model:o.value,"label-width":"80px"},{default:a(()=>[t(k,{label:"标题",required:""},{default:a(()=>[t(E,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.title=l),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(k,{label:"内容",required:""},{default:a(()=>[t(E,{modelValue:o.value.content,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.content=l),type:"textarea",rows:5,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),t(k,{label:"优先级"},{default:a(()=>[t(U,{modelValue:o.value.priority,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.priority=l)},{default:a(()=>[t(V,{label:"高",value:"high"}),t(V,{label:"中",value:"medium"}),t(V,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"关联赛事"},{default:a(()=>[t(U,{modelValue:o.value.link_event_id,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.link_event_id=l),clearable:"",placeholder:"可选"},{default:a(()=>[(c(!0),T(Q,null,R($.value,l=>(c(),y(V,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ae=L(Z,[["__scopeId","data-v-ad9126b2"]]);export{ae as default};
