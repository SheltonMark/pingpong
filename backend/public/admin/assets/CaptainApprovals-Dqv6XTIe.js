import{f as P}from"./format-JQP6GPa6.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,p as J,c as h,o as u,b as i,d as a,w as n,f as o,E as c,q as M,s as F,l as j,t as g,h as _,m as q,F as G,G as T}from"./index-DdmX5hyN.js";const L={class:"page"},H={style:{display:"flex","align-items":"center",gap:"8px"}},K={key:1,style:{color:"#67c23a"}},Q={style:{"margin-top":"20px","text-align":"right"}},R={__name:"CaptainApprovals",setup(W){const f=d(!1),x=d([]),v=d("pending"),b=d(1),w=d(0),k={pending:"待审批",approved:"已通过",rejected:"已拒绝"},$={pending:"warning",approved:"success",rejected:"danger"},y=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,p=async()=>{f.value=!0;try{const e=await(await fetch(`/api/admin/captain-applications?user_id=${y()}&status=${v.value}&page=${b.value}`)).json();e.success&&(x.value=e.data||[],w.value=e.total||0)}catch(s){console.error("加载申请列表失败:",s),c.error("加载失败")}finally{f.value=!1}},B=async s=>{try{await T.confirm(`确认批准 ${s.applicant_name} 成为赛事"${s.event_title}"的领队吗？`,"提示");const r=await(await fetch(`/api/admin/captain-applications/${s.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:y()})})).json();r.success?(c.success("已批准"),p()):c.error(r.message||"操作失败")}catch(e){e!=="cancel"&&(console.error("审批失败:",e),c.error("操作失败"))}},S=async s=>{try{const{value:e}=await T.prompt("请输入拒绝理由（可选）","拒绝申请",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入拒绝理由"}),m=await(await fetch(`/api/admin/captain-applications/${s.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:y(),reject_reason:e})})).json();m.success?(c.success("已拒绝"),p()):c.error(m.message||"操作失败")}catch(e){e!=="cancel"&&console.error("审批失败:",e)}};return J(()=>{p()}),(s,e)=>{const r=o("el-tab-pane"),m=o("el-tabs"),l=o("el-table-column"),N=o("el-avatar"),V=o("el-tag"),C=o("el-button"),A=o("el-tooltip"),D=o("el-table"),O=o("el-pagination"),z=o("el-card"),E=M("loading");return u(),h("div",L,[e[5]||(e[5]=i("div",{class:"page-header"},[i("h2",null,"领队申请审批")],-1)),a(z,null,{default:n(()=>[a(m,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),onTabChange:p},{default:n(()=>[a(r,{label:"待审批",name:"pending"}),a(r,{label:"已通过",name:"approved"}),a(r,{label:"已拒绝",name:"rejected"})]),_:1},8,["modelValue"]),F((u(),j(D,{data:x.value,stripe:""},{default:n(()=>[a(l,{prop:"id",label:"ID",width:"60"}),a(l,{prop:"event_title",label:"赛事","min-width":"150"}),a(l,{prop:"school_name",label:"学校",width:"120"}),a(l,{label:"申请人",width:"120"},{default:n(({row:t})=>[i("div",H,[a(N,{size:24,src:t.applicant_avatar},null,8,["src"]),i("span",null,g(t.applicant_name),1)])]),_:1}),a(l,{prop:"applicant_phone",label:"手机号",width:"120"}),a(l,{prop:"reason",label:"申请理由","min-width":"150"},{default:n(({row:t})=>[_(g(t.reason||"-"),1)]),_:1}),a(l,{prop:"status",label:"状态",width:"80"},{default:n(({row:t})=>[a(V,{type:$[t.status]},{default:n(()=>[_(g(k[t.status]),1)]),_:2},1032,["type"])]),_:1}),a(l,{label:"申请时间",width:"160"},{default:n(({row:t})=>[_(g(q(P)(t.created_at)),1)]),_:1}),a(l,{label:"操作",width:"180",fixed:"right"},{default:n(({row:t})=>[t.status==="pending"?(u(),h(G,{key:0},[a(C,{size:"small",type:"success",onClick:I=>B(t)},{default:n(()=>[...e[2]||(e[2]=[_("通过",-1)])]),_:1},8,["onClick"]),a(C,{size:"small",type:"danger",onClick:I=>S(t)},{default:n(()=>[...e[3]||(e[3]=[_("拒绝",-1)])]),_:1},8,["onClick"])],64)):t.status==="approved"?(u(),h("span",K,"已通过")):(u(),j(A,{key:2,content:t.reject_reason||"无",placement:"top"},{default:n(()=>[...e[4]||(e[4]=[i("span",{style:{color:"#f56c6c"}},"已拒绝",-1)])]),_:1},8,["content"]))]),_:1})]),_:1},8,["data"])),[[E,f.value]]),i("div",Q,[a(O,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=t=>b.value=t),"page-size":20,total:w.value,layout:"total, prev, pager, next",onCurrentChange:p},null,8,["current-page","total"])])]),_:1})])}}},ee=U(R,[["__scopeId","data-v-4881359c"]]);export{ee as default};
