import{r as _,i as C,j as x,a as S,c as v,o as m,b as P,k as b,d as o,t as N,w as t,e as z,f as i,u as q,l as B,g as E,h,m as R,E as u}from"./index-B_huGCKR.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"change-password-container"},L={class:"change-box"},O={class:"title"},T={key:0,class:"subtitle"},I={__name:"ChangePassword",setup(J){const n=q(),y=x(),f=_(null),c=_(!1),d=C(()=>y.query.first==="1"),s=S({oldPassword:"",newPassword:"",confirmPassword:""}),k={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(w,e,r)=>{e!==s.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},p=async()=>{if(!await f.value.validate().catch(()=>!1))return;const e=JSON.parse(localStorage.getItem("adminUser")||"{}");if(!e.id){u.error("请先登录"),n.push("/login");return}c.value=!0;try{const a=await(await fetch("/api/admin/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e.id,old_password:s.oldPassword,new_password:s.newPassword})})).json();a.success?(u.success("密码修改成功"),d.value?n.push("/events"):n.back()):u.error(a.message||"修改失败")}catch(r){console.error("Change password error:",r),u.error("修改失败，请重试")}finally{c.value=!1}};return(w,e)=>{const r=i("el-input"),a=i("el-form-item"),g=i("el-button"),V=i("el-form");return m(),v("div",j,[P("div",L,[P("h2",O,N(d.value?"设置新密码":"修改密码"),1),d.value?(m(),v("p",T,"首次登录请修改初始密码")):b("",!0),o(V,{model:s,rules:k,ref_key:"formRef",ref:f,onSubmit:z(p,["prevent"])},{default:t(()=>[o(a,{prop:"oldPassword"},{default:t(()=>[o(r,{modelValue:s.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=l=>s.oldPassword=l),type:"password",placeholder:"原密码","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o(a,{prop:"newPassword"},{default:t(()=>[o(r,{modelValue:s.newPassword,"onUpdate:modelValue":e[1]||(e[1]=l=>s.newPassword=l),type:"password",placeholder:"新密码（至少6位）","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o(a,{prop:"confirmPassword"},{default:t(()=>[o(r,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>s.confirmPassword=l),type:"password",placeholder:"确认新密码","prefix-icon":"Lock",size:"large","show-password":"",onKeyup:E(p,["enter"])},null,8,["modelValue"])]),_:1}),o(a,null,{default:t(()=>[o(g,{type:"primary",size:"large",loading:c.value,onClick:p,class:"submit-btn"},{default:t(()=>[...e[4]||(e[4]=[h(" 确认修改 ",-1)])]),_:1},8,["loading"])]),_:1}),d.value?b("",!0):(m(),B(a,{key:0},{default:t(()=>[o(g,{size:"large",onClick:e[3]||(e[3]=l=>R(n).back()),class:"back-btn"},{default:t(()=>[...e[5]||(e[5]=[h(" 返回 ",-1)])]),_:1})]),_:1}))]),_:1},8,["model"])])])}}},F=U(I,[["__scopeId","data-v-1fb0f0b8"]]);export{F as default};
