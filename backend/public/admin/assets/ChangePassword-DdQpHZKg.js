import{r as v,i as y,j as k,a as C,c as V,o as _,d as e,e as l,t as m,w as a,f as x,g as w,u as S,k as B,l as N,h as q,n as z,m as E,E as p}from"./index-HkKn3S-D.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"change-password-container"},U={class:"change-card"},j={class:"card-header"},O={class:"title"},I={class:"subtitle"},J=["disabled"],K={class:"btn-text"},L={__name:"ChangePassword",setup(T){const i=S(),b=k(),f=v(null),d=v(!1),u=y(()=>b.query.first==="1"),o=C({oldPassword:"",newPassword:"",confirmPassword:""}),P={oldPassword:[{required:!0,message:"è¯·è¾“å…¥åŸå¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç è‡³å°‘6ä½",trigger:"blur"}],confirmPassword:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç ",trigger:"blur"},{validator:(g,s,r)=>{s!==o.newPassword?r(new Error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")):r()},trigger:"blur"}]},c=async()=>{if(!await f.value.validate().catch(()=>!1))return;const s=JSON.parse(localStorage.getItem("adminUser")||"{}");if(!s.id){p.error("è¯·å…ˆç™»å½•"),i.push("/login");return}d.value=!0;try{const t=await(await fetch("/api/admin/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:s.id,old_password:o.oldPassword,new_password:o.newPassword})})).json();t.success?(p.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),u.value?i.push("/events"):i.back()):p.error(t.message||"ä¿®æ”¹å¤±è´¥")}catch(r){console.error("Change password error:",r),p.error("ä¿®æ”¹å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{d.value=!1}};return(g,s)=>{const r=w("el-input"),t=w("el-form-item"),h=w("el-form");return _(),V("div",R,[s[8]||(s[8]=e("div",{class:"table-lines"},[e("div",{class:"center-line"}),e("div",{class:"net"})],-1)),s[9]||(s[9]=e("div",{class:"ball ball-1"},null,-1)),e("div",U,[e("div",j,[s[4]||(s[4]=e("div",{class:"logo-icon"},[e("svg",{viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{cx:"20",cy:"20",r:"18",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M14 20 L26 20 M20 14 L20 26",stroke:"currentColor","stroke-width":"2"})])],-1)),e("h1",O,m(u.value?"è®¾ç½®æ–°å¯†ç ":"ä¿®æ”¹å¯†ç "),1),e("p",I,m(u.value?"é¦–æ¬¡ç™»å½•è¯·ä¿®æ”¹åˆå§‹å¯†ç ":"è¯·è¾“å…¥æ–°å¯†ç "),1)]),l(h,{model:o,rules:P,ref_key:"formRef",ref:f,onSubmit:x(c,["prevent"]),class:"change-form"},{default:a(()=>[l(t,{prop:"oldPassword"},{default:a(()=>[l(r,{modelValue:o.oldPassword,"onUpdate:modelValue":s[0]||(s[0]=n=>o.oldPassword=n),type:"password",placeholder:"åŸå¯†ç ",size:"large","show-password":""},{prefix:a(()=>[...s[5]||(s[5]=[e("span",{class:"input-icon"},"ğŸ”‘",-1)])]),_:1},8,["modelValue"])]),_:1}),l(t,{prop:"newPassword"},{default:a(()=>[l(r,{modelValue:o.newPassword,"onUpdate:modelValue":s[1]||(s[1]=n=>o.newPassword=n),type:"password",placeholder:"æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",size:"large","show-password":""},{prefix:a(()=>[...s[6]||(s[6]=[e("span",{class:"input-icon"},"ğŸ”",-1)])]),_:1},8,["modelValue"])]),_:1}),l(t,{prop:"confirmPassword"},{default:a(()=>[l(r,{modelValue:o.confirmPassword,"onUpdate:modelValue":s[2]||(s[2]=n=>o.confirmPassword=n),type:"password",placeholder:"ç¡®è®¤æ–°å¯†ç ",size:"large","show-password":"",onKeyup:q(c,["enter"])},{prefix:a(()=>[...s[7]||(s[7]=[e("span",{class:"input-icon"},"âœ“",-1)])]),_:1},8,["modelValue"])]),_:1}),l(t,null,{default:a(()=>[e("button",{type:"button",class:z(["submit-btn",{loading:d.value}]),disabled:d.value,onClick:c},[e("span",K,m(d.value?"æäº¤ä¸­...":"ç¡®è®¤ä¿®æ”¹"),1)],10,J)]),_:1}),u.value?N("",!0):(_(),B(t,{key:0},{default:a(()=>[e("button",{type:"button",class:"back-btn",onClick:s[3]||(s[3]=n=>E(i).back())}," â† è¿”å› ")]),_:1}))]),_:1},8,["model"])])])}}},A=M(L,[["__scopeId","data-v-f60efb72"]]);export{A as default};
