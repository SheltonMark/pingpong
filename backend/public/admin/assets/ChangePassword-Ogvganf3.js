import{r as g,i as V,j as k,a as C,c as x,o as _,b as v,d as o,t as S,w as t,e as N,f as d,u as z,k as q,l as B,g as E,h as P,m as R,E as i}from"./index-l52RVg3u.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"change-password-container"},L={class:"change-box"},O={class:"title"},T={__name:"ChangePassword",setup(I){const n=z(),h=k(),m=g(null),u=g(!1),p=V(()=>h.query.first==="1"),s=C({oldPassword:"",newPassword:"",confirmPassword:""}),y={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(w,e,r)=>{e!==s.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},c=async()=>{if(!await m.value.validate().catch(()=>!1))return;const e=JSON.parse(localStorage.getItem("adminUser")||"{}");if(!e.id){i.error("请先登录"),n.push("/login");return}u.value=!0;try{const a=await(await fetch("/api/admin/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e.id,old_password:s.oldPassword,new_password:s.newPassword})})).json();a.success?(i.success("密码修改成功"),p.value?n.push("/events"):n.back()):i.error(a.message||"修改失败")}catch(r){console.error("Change password error:",r),i.error("修改失败，请重试")}finally{u.value=!1}};return(w,e)=>{const r=d("el-input"),a=d("el-form-item"),f=d("el-button"),b=d("el-form");return _(),x("div",j,[v("div",L,[v("h2",O,S(p.value?"首次登录，请修改密码":"修改密码"),1),o(b,{model:s,rules:y,ref_key:"formRef",ref:m,onSubmit:N(c,["prevent"])},{default:t(()=>[o(a,{prop:"oldPassword"},{default:t(()=>[o(r,{modelValue:s.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=l=>s.oldPassword=l),type:"password",placeholder:"原密码","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o(a,{prop:"newPassword"},{default:t(()=>[o(r,{modelValue:s.newPassword,"onUpdate:modelValue":e[1]||(e[1]=l=>s.newPassword=l),type:"password",placeholder:"新密码（至少6位）","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o(a,{prop:"confirmPassword"},{default:t(()=>[o(r,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>s.confirmPassword=l),type:"password",placeholder:"确认新密码","prefix-icon":"Lock",size:"large","show-password":"",onKeyup:E(c,["enter"])},null,8,["modelValue"])]),_:1}),o(a,null,{default:t(()=>[o(f,{type:"primary",size:"large",loading:u.value,onClick:c,style:{width:"100%"}},{default:t(()=>[...e[4]||(e[4]=[P(" 确认修改 ",-1)])]),_:1},8,["loading"])]),_:1}),p.value?B("",!0):(_(),q(a,{key:0},{default:t(()=>[o(f,{size:"large",onClick:e[3]||(e[3]=l=>R(n).back()),style:{width:"100%"}},{default:t(()=>[...e[5]||(e[5]=[P(" 返回 ",-1)])]),_:1})]),_:1}))]),_:1},8,["model"])])])}}},D=U(T,[["__scopeId","data-v-cf0be69c"]]);export{D as default};
