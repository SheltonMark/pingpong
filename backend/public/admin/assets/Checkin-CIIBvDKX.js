import{a as g}from"./index-B9ygI19o.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,p as J,c as $,o as b,b as h,d as l,w as t,f as s,E as i,q as K,h as m,s as O,l as B,t as Q,F as R,v as W,z as X}from"./index-02hBXzKO.js";const Y={class:"page"},Z={class:"page-header"},v="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",ee={__name:"Checkin",setup(le){const V=d(!1),x=d([]),C=d([]),r=d(!1),c=d(!1),y=d(!1),o=d({name:"",latitude:"",longitude:"",radius:100,school_id:null}),w=async()=>{V.value=!0;try{const n=await g.get(`${v}/api/admin/checkin-points`);n.data.success&&(x.value=n.data.data||[])}catch(n){console.error("加载签到点失败:",n),i.error("加载失败")}finally{V.value=!1}},E=async()=>{try{const n=await g.get(`${v}/api/common/schools`);n.data.success&&(C.value=n.data.data||[])}catch(n){console.error("加载学校失败:",n)}},P=()=>{c.value=!1,o.value={name:"",latitude:"",longitude:"",radius:100,school_id:null},r.value=!0},U=n=>{c.value=!0,o.value={...n},r.value=!0},D=async()=>{if(!o.value.name||!o.value.latitude||!o.value.longitude){i.warning("请填写名称和坐标");return}y.value=!0;try{const n=c.value?`${v}/api/admin/checkin-points/${o.value.id}`:`${v}/api/admin/checkin-points`,e=c.value?"put":"post",f=await g[e](n,o.value);f.data.success?(i.success(c.value?"更新成功":"添加成功"),r.value=!1,w()):i.error(f.data.message||"操作失败")}catch(n){console.error("提交失败:",n),i.error("操作失败")}finally{y.value=!1}},q=async n=>{try{await X.confirm("确定要删除这个签到点吗？","提示",{type:"warning"});const e=await g.delete(`${v}/api/admin/checkin-points/${n.id}`);e.data.success?(i.success("删除成功"),w()):i.error(e.data.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),i.error("删除失败"))}};return J(()=>{w(),E()}),(n,e)=>{const f=s("Plus"),z=s("el-icon"),p=s("el-button"),u=s("el-table-column"),F=s("el-tag"),I=s("el-table"),M=s("el-card"),k=s("el-input"),_=s("el-form-item"),N=s("el-input-number"),S=s("el-option"),A=s("el-select"),L=s("el-form"),T=s("el-dialog"),j=K("loading");return b(),$("div",Y,[h("div",Z,[e[8]||(e[8]=h("h2",null,"签到点管理",-1)),l(p,{type:"primary",onClick:P},{default:t(()=>[l(z,null,{default:t(()=>[l(f)]),_:1}),e[7]||(e[7]=m(" 添加签到点 ",-1))]),_:1})]),l(M,null,{default:t(()=>[O((b(),B(I,{data:x.value,stripe:""},{default:t(()=>[l(u,{prop:"id",label:"ID",width:"60"}),l(u,{prop:"name",label:"名称","min-width":"150"}),l(u,{prop:"latitude",label:"纬度",width:"120"}),l(u,{prop:"longitude",label:"经度",width:"120"}),l(u,{prop:"radius",label:"有效半径(米)",width:"120"}),l(u,{prop:"school_name",label:"所属学校",width:"150"}),l(u,{prop:"status",label:"状态",width:"80"},{default:t(({row:a})=>[l(F,{type:a.status==="active"?"success":"info"},{default:t(()=>[m(Q(a.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(p,{size:"small",onClick:G=>U(a)},{default:t(()=>[...e[9]||(e[9]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",type:"danger",onClick:G=>q(a)},{default:t(()=>[...e[10]||(e[10]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,V.value]])]),_:1}),l(T,{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value=a),title:c.value?"编辑签到点":"添加签到点",width:"500px"},{footer:t(()=>[l(p,{onClick:e[5]||(e[5]=a=>r.value=!1)},{default:t(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:D,loading:y.value},{default:t(()=>[...e[13]||(e[13]=[m("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(L,{model:o.value,"label-width":"100px"},{default:t(()=>[l(_,{label:"名称",required:""},{default:t(()=>[l(k,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a),placeholder:"如：体育馆一楼"},null,8,["modelValue"])]),_:1}),l(_,{label:"纬度",required:""},{default:t(()=>[l(k,{modelValue:o.value.latitude,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.latitude=a),placeholder:"如：30.123456"},null,8,["modelValue"])]),_:1}),l(_,{label:"经度",required:""},{default:t(()=>[l(k,{modelValue:o.value.longitude,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.longitude=a),placeholder:"如：120.123456"},null,8,["modelValue"])]),_:1}),l(_,{label:"有效半径"},{default:t(()=>[l(N,{modelValue:o.value.radius,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.radius=a),min:10,max:1e3},null,8,["modelValue"]),e[11]||(e[11]=h("span",{style:{"margin-left":"10px",color:"#999"}},"米",-1))]),_:1}),l(_,{label:"所属学校"},{default:t(()=>[l(A,{modelValue:o.value.school_id,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.school_id=a),clearable:"",placeholder:"请选择"},{default:t(()=>[(b(!0),$(R,null,W(C.value,a=>(b(),B(S,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=H(ee,[["__scopeId","data-v-da73084a"]]);export{ne as default};
