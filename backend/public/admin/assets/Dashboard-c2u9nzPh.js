import{a as w}from"./index-B9ygI19o.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as y,n as W,c as i,o as c,b as s,d as a,w as e,f as d,p as j,t as n,h as p,q as k,F as z,s as T,v as G,x as H}from"./index-CDHrMpP-.js";const J={class:"page"},K={class:"stat-icon",style:{background:"#409eff"}},Q={class:"stat-info"},R={class:"stat-value"},X={class:"stat-footer"},Y={class:"highlight"},Z={class:"stat-icon",style:{background:"#67c23a"}},ss={class:"stat-info"},ts={class:"stat-value"},as={class:"stat-footer"},es={class:"highlight"},os={class:"stat-icon",style:{background:"#e6a23c"}},ns={class:"stat-info"},ls={class:"stat-value"},is={class:"stat-footer"},cs={class:"highlight"},ds={class:"stat-icon",style:{background:"#f56c6c"}},rs={class:"stat-info"},us={class:"stat-value"},_s={class:"stat-footer"},vs={class:"highlight"},ps={class:"chart-container"},hs={class:"bar-label"},fs={class:"bar-wrapper"},ys={class:"bar-count"},gs={class:"chart-container"},ms={class:"rank-name"},bs={class:"rank-count"},ws={class:"status-grid"},ks={class:"status-count"},Ss={class:"activity-grid"},xs={class:"activity-item"},zs={class:"activity-value"},Ts={class:"activity-item"},Ds={class:"activity-value"},Cs={class:"activity-item"},Es={class:"activity-value"},S="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",Us={__name:"Dashboard",setup(Bs){const h=y(!1),v=y({totalUsers:0,totalEvents:0,totalMatches:0,totalPosts:0,weekNewUsers:0,ongoingEvents:0}),g=y({byType:[],bySchool:[]}),D=y({byStatus:[],byType:[]}),f=y({posts:0,checkins:0,matches:0}),B={student:"在校生",graduate:"毕业生",teacher:"老师",staff:"教职工"},L={draft:"草稿",registration:"报名中",ongoing:"进行中",finished:"已结束",cancelled:"已取消"},N={draft:"info",registration:"warning",ongoing:"success",finished:"",cancelled:"danger"},P=(o,t)=>{const m=Math.max(...t.map(r=>r.count));return m>0?`${o/m*100}%`:"0%"},$=async()=>{try{const o=await w.get(`${S}/api/admin/dashboard`);o.data.success&&(v.value=o.data.data)}catch(o){console.error("加载概览失败:",o)}},M=async()=>{try{const o=await w.get(`${S}/api/admin/stats/users`);o.data.success&&(g.value=o.data.data)}catch(o){console.error("加载用户统计失败:",o)}},q=async()=>{try{const o=await w.get(`${S}/api/admin/stats/events`);o.data.success&&(D.value=o.data.data)}catch(o){console.error("加载赛事统计失败:",o)}},A=async()=>{try{const o=await w.get(`${S}/api/admin/stats/activity`);o.data.success&&(f.value=o.data.data.today)}catch(o){console.error("加载活跃统计失败:",o)}};return W(async()=>{h.value=!0,await Promise.all([$(),M(),q(),A()]),h.value=!1}),(o,t)=>{const m=d("User"),r=d("el-icon"),u=d("el-card"),_=d("el-col"),V=d("Trophy"),C=d("Connection"),E=d("ChatDotSquare"),x=d("el-row"),F=d("el-tag"),I=d("Location"),b=j("loading");return c(),i("div",J,[t[17]||(t[17]=s("div",{class:"page-header"},[s("h2",null,"数据概览")],-1)),a(x,{gutter:20,class:"stats-row"},{default:e(()=>[a(_,{span:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[s("div",K,[a(r,{size:"28"},{default:e(()=>[a(m)]),_:1})]),s("div",Q,[s("div",R,n(v.value.totalUsers),1),t[0]||(t[0]=s("div",{class:"stat-label"},"注册用户",-1))]),s("div",X,[t[1]||(t[1]=p(" 本周新增 ",-1)),s("span",Y,n(v.value.weekNewUsers),1)])]),_:1})]),_:1}),a(_,{span:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[s("div",Z,[a(r,{size:"28"},{default:e(()=>[a(V)]),_:1})]),s("div",ss,[s("div",ts,n(v.value.totalEvents),1),t[2]||(t[2]=s("div",{class:"stat-label"},"赛事总数",-1))]),s("div",as,[t[3]||(t[3]=p(" 进行中 ",-1)),s("span",es,n(v.value.ongoingEvents),1)])]),_:1})]),_:1}),a(_,{span:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[s("div",os,[a(r,{size:"28"},{default:e(()=>[a(C)]),_:1})]),s("div",ns,[s("div",ls,n(v.value.totalMatches),1),t[4]||(t[4]=s("div",{class:"stat-label"},"完成比赛",-1))]),s("div",is,[t[5]||(t[5]=p(" 今日 ",-1)),s("span",cs,n(f.value.matches),1),t[6]||(t[6]=p(" 场 ",-1))])]),_:1})]),_:1}),a(_,{span:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[s("div",ds,[a(r,{size:"28"},{default:e(()=>[a(E)]),_:1})]),s("div",rs,[s("div",us,n(v.value.totalPosts),1),t[7]||(t[7]=s("div",{class:"stat-label"},"帖子总数",-1))]),s("div",_s,[t[8]||(t[8]=p(" 今日 ",-1)),s("span",vs,n(f.value.posts),1),t[9]||(t[9]=p(" 篇 ",-1))])]),_:1})]),_:1})]),_:1}),a(x,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[a(_,{span:12},{default:e(()=>[a(u,null,{header:e(()=>[...t[10]||(t[10]=[s("span",null,"用户类型分布",-1)])]),default:e(()=>[k((c(),i("div",ps,[(c(!0),i(z,null,T(g.value.byType,l=>(c(),i("div",{key:l.user_type,class:"bar-item"},[s("div",hs,n(B[l.user_type]||l.user_type),1),s("div",fs,[s("div",{class:"bar",style:G({width:P(l.count,g.value.byType)})},null,4)]),s("div",ys,n(l.count),1)]))),128))])),[[b,h.value]])]),_:1})]),_:1}),a(_,{span:12},{default:e(()=>[a(u,null,{header:e(()=>[...t[11]||(t[11]=[s("span",null,"学校用户排名 TOP 10",-1)])]),default:e(()=>[k((c(),i("div",gs,[(c(!0),i(z,null,T(g.value.bySchool,(l,U)=>(c(),i("div",{key:l.school_name,class:"rank-item"},[s("span",{class:H(["rank-num",{top3:U<3}])},n(U+1),3),s("span",ms,n(l.school_name),1),s("span",bs,n(l.count)+" 人",1)]))),128))])),[[b,h.value]])]),_:1})]),_:1})]),_:1}),a(x,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[a(_,{span:12},{default:e(()=>[a(u,null,{header:e(()=>[...t[12]||(t[12]=[s("span",null,"赛事状态",-1)])]),default:e(()=>[k((c(),i("div",ws,[(c(!0),i(z,null,T(D.value.byStatus,l=>(c(),i("div",{key:l.status,class:"status-item"},[a(F,{type:N[l.status],size:"large"},{default:e(()=>[p(n(L[l.status]||l.status),1)]),_:2},1032,["type"]),s("span",ks,n(l.count),1)]))),128))])),[[b,h.value]])]),_:1})]),_:1}),a(_,{span:12},{default:e(()=>[a(u,null,{header:e(()=>[...t[13]||(t[13]=[s("span",null,"今日活跃",-1)])]),default:e(()=>[k((c(),i("div",Ss,[s("div",xs,[a(r,{size:"32",color:"#409eff"},{default:e(()=>[a(I)]),_:1}),s("div",zs,n(f.value.checkins),1),t[14]||(t[14]=s("div",{class:"activity-label"},"签到次数",-1))]),s("div",Ts,[a(r,{size:"32",color:"#67c23a"},{default:e(()=>[a(C)]),_:1}),s("div",Ds,n(f.value.matches),1),t[15]||(t[15]=s("div",{class:"activity-label"},"完成比赛",-1))]),s("div",Cs,[a(r,{size:"32",color:"#e6a23c"},{default:e(()=>[a(E)]),_:1}),s("div",Es,n(f.value.posts),1),t[16]||(t[16]=s("div",{class:"activity-label"},"发布帖子",-1))])])),[[b,h.value]])]),_:1})]),_:1})]),_:1})])}}},$s=O(Us,[["__scopeId","data-v-e4d1be37"]]);export{$s as default};
