import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as y,p as O,c as i,o as c,b as t,d as a,w as e,f as d,q as A,t as o,h,s as k,F as S,v as z,x as J,y as W}from"./index-Di6oD7Bk.js";const G={class:"page"},H={class:"stat-icon",style:{background:"#409eff"}},K={class:"stat-info"},Q={class:"stat-value"},R={class:"stat-footer"},X={class:"highlight"},Y={class:"stat-icon",style:{background:"#67c23a"}},Z={class:"stat-info"},ss={class:"stat-value"},ts={class:"stat-footer"},as={class:"highlight"},es={class:"stat-icon",style:{background:"#e6a23c"}},os={class:"stat-info"},ns={class:"stat-value"},ls={class:"stat-footer"},is={class:"highlight"},cs={class:"stat-icon",style:{background:"#f56c6c"}},ds={class:"stat-info"},rs={class:"stat-value"},us={class:"stat-footer"},_s={class:"highlight"},vs={class:"chart-container"},hs={class:"bar-label"},fs={class:"bar-wrapper"},ps={class:"bar-count"},ys={class:"chart-container"},ms={class:"rank-name"},gs={class:"rank-count"},bs={class:"status-grid"},ws={class:"status-count"},ks={class:"activity-grid"},xs={class:"activity-item"},Ss={class:"activity-value"},zs={class:"activity-item"},Ts={class:"activity-value"},Us={class:"activity-item"},Ds={class:"activity-value"},Cs={__name:"Dashboard",setup(Es){const f=y(!1),v=y({totalUsers:0,totalEvents:0,totalMatches:0,totalPosts:0,weekNewUsers:0,ongoingEvents:0}),m=y({byType:[],bySchool:[]}),T=y({byStatus:[],byType:[]}),p=y({posts:0,checkins:0,matches:0}),E={student:"在校生",graduate:"毕业生",teacher:"老师",staff:"教职工"},N={draft:"草稿",registration:"报名中",ongoing:"进行中",finished:"已结束",cancelled:"已取消"},L={draft:"info",registration:"warning",ongoing:"success",finished:"",cancelled:"danger"},g=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,$=(n,s)=>{const b=Math.max(...s.map(r=>r.count));return b>0?`${n/b*100}%`:"0%"},j=async()=>{try{const s=await(await fetch(`/api/admin/dashboard?user_id=${g()}`)).json();s.success&&(v.value=s.data)}catch(n){console.error("加载概览失败:",n)}},q=async()=>{try{const s=await(await fetch(`/api/admin/stats/users?user_id=${g()}`)).json();s.success&&(m.value=s.data)}catch(n){console.error("加载用户统计失败:",n)}},B=async()=>{try{const s=await(await fetch(`/api/admin/stats/events?user_id=${g()}`)).json();s.success&&(T.value=s.data)}catch(n){console.error("加载赛事统计失败:",n)}},M=async()=>{try{const s=await(await fetch(`/api/admin/stats/activity?user_id=${g()}`)).json();s.success&&(p.value=s.data.today)}catch(n){console.error("加载活跃统计失败:",n)}};return O(async()=>{f.value=!0,await Promise.all([j(),q(),B(),M()]),f.value=!1}),(n,s)=>{const b=d("User"),r=d("el-icon"),u=d("el-card"),_=d("el-col"),P=d("Trophy"),U=d("Connection"),D=d("ChatDotSquare"),x=d("el-row"),I=d("el-tag"),V=d("Location"),w=A("loading");return c(),i("div",G,[s[17]||(s[17]=t("div",{class:"page-header"},[t("h2",null,"数据概览")],-1)),a(x,{gutter:20,class:"stats-row"},{default:e(()=>[a(_,{xs:12,sm:12,md:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[t("div",H,[a(r,{size:"28"},{default:e(()=>[a(b)]),_:1})]),t("div",K,[t("div",Q,o(v.value.totalUsers),1),s[0]||(s[0]=t("div",{class:"stat-label"},"注册用户",-1))]),t("div",R,[s[1]||(s[1]=h(" 本周新增 ",-1)),t("span",X,o(v.value.weekNewUsers),1)])]),_:1})]),_:1}),a(_,{xs:12,sm:12,md:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[t("div",Y,[a(r,{size:"28"},{default:e(()=>[a(P)]),_:1})]),t("div",Z,[t("div",ss,o(v.value.totalEvents),1),s[2]||(s[2]=t("div",{class:"stat-label"},"赛事总数",-1))]),t("div",ts,[s[3]||(s[3]=h(" 进行中 ",-1)),t("span",as,o(v.value.ongoingEvents),1)])]),_:1})]),_:1}),a(_,{xs:12,sm:12,md:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[t("div",es,[a(r,{size:"28"},{default:e(()=>[a(U)]),_:1})]),t("div",os,[t("div",ns,o(v.value.totalMatches),1),s[4]||(s[4]=t("div",{class:"stat-label"},"完成比赛",-1))]),t("div",ls,[s[5]||(s[5]=h(" 今日 ",-1)),t("span",is,o(p.value.matches),1),s[6]||(s[6]=h(" 场 ",-1))])]),_:1})]),_:1}),a(_,{xs:12,sm:12,md:6},{default:e(()=>[a(u,{class:"stat-card",shadow:"hover"},{default:e(()=>[t("div",cs,[a(r,{size:"28"},{default:e(()=>[a(D)]),_:1})]),t("div",ds,[t("div",rs,o(v.value.totalPosts),1),s[7]||(s[7]=t("div",{class:"stat-label"},"帖子总数",-1))]),t("div",us,[s[8]||(s[8]=h(" 今日 ",-1)),t("span",_s,o(p.value.posts),1),s[9]||(s[9]=h(" 篇 ",-1))])]),_:1})]),_:1})]),_:1}),a(x,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[a(_,{xs:24,sm:24,md:12},{default:e(()=>[a(u,null,{header:e(()=>[...s[10]||(s[10]=[t("span",null,"用户类型分布",-1)])]),default:e(()=>[k((c(),i("div",vs,[(c(!0),i(S,null,z(m.value.byType,l=>(c(),i("div",{key:l.user_type,class:"bar-item"},[t("div",hs,o(E[l.user_type]||l.user_type),1),t("div",fs,[t("div",{class:"bar",style:J({width:$(l.count,m.value.byType)})},null,4)]),t("div",ps,o(l.count),1)]))),128))])),[[w,f.value]])]),_:1})]),_:1}),a(_,{xs:24,sm:24,md:12},{default:e(()=>[a(u,null,{header:e(()=>[...s[11]||(s[11]=[t("span",null,"学校用户排名 TOP 10",-1)])]),default:e(()=>[k((c(),i("div",ys,[(c(!0),i(S,null,z(m.value.bySchool,(l,C)=>(c(),i("div",{key:l.school_name,class:"rank-item"},[t("span",{class:W(["rank-num",{top3:C<3}])},o(C+1),3),t("span",ms,o(l.school_name),1),t("span",gs,o(l.count)+" 人",1)]))),128))])),[[w,f.value]])]),_:1})]),_:1})]),_:1}),a(x,{gutter:20,style:{"margin-top":"20px"},class:"equal-height-row"},{default:e(()=>[a(_,{xs:24,sm:24,md:12},{default:e(()=>[a(u,null,{header:e(()=>[...s[12]||(s[12]=[t("span",null,"赛事状态",-1)])]),default:e(()=>[k((c(),i("div",bs,[(c(!0),i(S,null,z(T.value.byStatus,l=>(c(),i("div",{key:l.status,class:"status-item"},[a(I,{type:L[l.status],size:"large"},{default:e(()=>[h(o(N[l.status]||l.status),1)]),_:2},1032,["type"]),t("span",ws,o(l.count),1)]))),128))])),[[w,f.value]])]),_:1})]),_:1}),a(_,{xs:24,sm:24,md:12},{default:e(()=>[a(u,null,{header:e(()=>[...s[13]||(s[13]=[t("span",null,"今日活跃",-1)])]),default:e(()=>[k((c(),i("div",ks,[t("div",xs,[a(r,{size:"32",color:"#409eff"},{default:e(()=>[a(V)]),_:1}),t("div",Ss,o(p.value.checkins),1),s[14]||(s[14]=t("div",{class:"activity-label"},"签到次数",-1))]),t("div",zs,[a(r,{size:"32",color:"#67c23a"},{default:e(()=>[a(U)]),_:1}),t("div",Ts,o(p.value.matches),1),s[15]||(s[15]=t("div",{class:"activity-label"},"完成比赛",-1))]),t("div",Us,[a(r,{size:"32",color:"#e6a23c"},{default:e(()=>[a(D)]),_:1}),t("div",Ds,o(p.value.posts),1),s[16]||(s[16]=t("div",{class:"activity-label"},"发布帖子",-1))])])),[[w,f.value]])]),_:1})]),_:1})]),_:1})])}}},$s=F(Cs,[["__scopeId","data-v-319337f3"]]);export{$s as default};
