import{f as M}from"./format-DoeqoNZs.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,p as F,c as x,o as u,b as s,d as a,k as D,w as n,f as o,q as J,F as L,v as q,l as w,s as G,t as i,h as _,m as A,G as H,E as m}from"./index-CFDikFN1.js";const K={class:"page"},Q={class:"page-header"},R={class:"header-actions"},W={style:{display:"flex","align-items":"center",gap:"8px"}},X={style:{"font-size":"12px",color:"#999"}},Y={style:{display:"flex","align-items":"center",gap:"8px"}},Z={style:{"font-size":"12px",color:"#999"}},ee={style:{"margin-top":"20px","text-align":"right"}},te={key:0,class:"empty-state"},ae={__name:"DoublesPairs",setup(se){const v=d(!1),f=d([]),k=d([]),p=d(null),g=d(1),y=d(0),$={pending:"待确认",confirmed:"已确认",waiting_partner:"待配对",cancelled:"已取消"},E={pending:"warning",confirmed:"success",waiting_partner:"info",cancelled:"danger"},h=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,V=async()=>{try{const t=await(await fetch(`/api/admin/events?user_id=${h()}`)).json();t.success&&(k.value=(t.data||[]).filter(c=>c.event_type==="doubles"))}catch(l){console.error("加载双打赛事失败:",l)}},b=async()=>{if(!p.value){f.value=[],y.value=0;return}v.value=!0;try{const t=await(await fetch(`/api/admin/doubles-pairs?user_id=${h()}&event_id=${p.value}&page=${g.value}`)).json();t.success&&(f.value=t.data||[],y.value=t.total||0)}catch(l){console.error("加载双打配对失败:",l),m.error("加载失败")}finally{v.value=!1}},z=async l=>{try{await H.confirm(`确认取消 ${l.player1_name} 和 ${l.player2_name} 的配对吗？`,"提示");const c=await(await fetch(`/api/admin/doubles-pairs/${l.id}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:h()})})).json();c.success?(m.success("已取消配对"),b()):m.error(c.message||"操作失败")}catch(t){t!=="cancel"&&(console.error("取消配对失败:",t),m.error("操作失败"))}};return F(()=>{V()}),(l,t)=>{const c=o("el-option"),N=o("el-select"),r=o("el-table-column"),C=o("el-avatar"),P=o("el-tag"),B=o("el-button"),I=o("el-table"),S=o("el-pagination"),T=o("el-card"),j=o("el-empty"),U=J("loading");return u(),x("div",K,[s("div",Q,[t[2]||(t[2]=s("h2",null,"双打配对管理",-1)),s("div",R,[a(N,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),placeholder:"选择赛事",clearable:"",onChange:b},{default:n(()=>[(u(!0),x(L,null,q(k.value,e=>(u(),w(c,{key:e.id,label:e.title,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(T,null,{default:n(()=>[G((u(),w(I,{data:f.value,stripe:""},{default:n(()=>[a(r,{prop:"id",label:"ID",width:"60"}),a(r,{label:"选手1","min-width":"150"},{default:n(({row:e})=>[s("div",W,[a(C,{size:32,src:e.player1_avatar},null,8,["src"]),s("div",null,[s("div",null,i(e.player1_name),1),s("div",X,i(e.player1_phone),1)])])]),_:1}),a(r,{label:"选手2","min-width":"150"},{default:n(({row:e})=>[s("div",Y,[a(C,{size:32,src:e.player2_avatar},null,8,["src"]),s("div",null,[s("div",null,i(e.player2_name),1),s("div",Z,i(e.player2_phone),1)])])]),_:1}),a(r,{prop:"team_name",label:"组合名称",width:"120"},{default:n(({row:e})=>[_(i(e.team_name||"-"),1)]),_:1}),a(r,{prop:"status",label:"状态",width:"100"},{default:n(({row:e})=>[a(P,{type:E[e.status]},{default:n(()=>[_(i($[e.status]),1)]),_:2},1032,["type"])]),_:1}),a(r,{label:"报名时间",width:"160"},{default:n(({row:e})=>[_(i(A(M)(e.created_at)),1)]),_:1}),a(r,{label:"操作",width:"120",fixed:"right"},{default:n(({row:e})=>[e.status==="pending"?(u(),w(B,{key:0,size:"small",type:"danger",onClick:le=>z(e)},{default:n(()=>[...t[3]||(t[3]=[_("取消配对",-1)])]),_:1},8,["onClick"])):D("",!0)]),_:1})]),_:1},8,["data"])),[[U,v.value]]),s("div",ee,[a(S,{"current-page":g.value,"onUpdate:currentPage":t[1]||(t[1]=e=>g.value=e),"page-size":20,total:y.value,layout:"total, prev, pager, next",onCurrentChange:b},null,8,["current-page","total"])])]),_:1}),p.value?D("",!0):(u(),x("div",te,[a(j,{description:"请选择一个双打赛事查看配对情况"})]))])}}},ie=O(ae,[["__scopeId","data-v-16e3eb77"]]);export{ie as default};
