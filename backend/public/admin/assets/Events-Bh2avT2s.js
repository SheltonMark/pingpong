import{f as X}from"./format-JQP6GPa6.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,p as h,c as ee,o as $,b as i,d as t,w as o,f as s,E as p,q as te,h as d,s as le,l as oe,t as U,m as ae,z as I}from"./index-wZSs7Alf.js";const ne={class:"page"},se={class:"page-header"},ie={style:{display:"flex","align-items":"center",gap:"10px"}},ue={class:"rich-editor"},re={class:"toolbar"},de=["innerHTML"],me={__name:"Events",setup(pe){const y=_(!1),Y=_([]),f=_(!1),v=_(!1),k=_(!1),D=_(null),a=_({title:"",event_type:"singles",event_format:"knockout",best_of:5,games_to_win:3,counts_for_ranking:!0,event_start:"",location:"",max_participants:32,registration_end:"",description:""}),b=n=>{var e;document.execCommand(n,!1,null),(e=D.value)==null||e.focus()},z=()=>{I.prompt("请输入图片URL","插入图片",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"https://..."}).then(({value:n})=>{n&&document.execCommand("insertImage",!1,n)}).catch(()=>{})},B=n=>{a.value.description=n.target.innerHTML},L={singles:"单打",doubles:"双打",team:"团体"},q={draft:"草稿",registration:"报名中",ongoing:"进行中",finished:"已结束"},N={draft:"info",registration:"warning",ongoing:"success",finished:""},w=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,x=async()=>{y.value=!0;try{const e=await(await fetch(`/api/admin/events?user_id=${w()}`)).json();e.success&&(Y.value=e.data||[])}catch(n){console.error("加载赛事失败:",n),p.error("加载赛事失败")}finally{y.value=!1}},P=()=>{v.value=!1,a.value={title:"",event_type:"singles",event_format:"knockout",best_of:5,games_to_win:3,counts_for_ranking:!0,event_start:"",location:"",max_participants:32,registration_end:"",description:""},f.value=!0},S=n=>{v.value=!0,a.value={...n},f.value=!0},j=async()=>{if(!a.value.title){p.warning("请输入赛事名称");return}k.value=!0;try{const n=v.value?`/api/admin/events/${a.value.id}`:"/api/admin/events",e=v.value?"PUT":"POST",V=await(await fetch(n,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({...a.value,user_id:w()})})).json();V.success?(p.success(v.value?"更新成功":"创建成功"),f.value=!1,x()):p.error(V.message||"操作失败")}catch(n){console.error("提交失败:",n),p.error("操作失败")}finally{k.value=!1}},O=async n=>{try{await I.confirm("确定要删除这个赛事吗？","提示",{type:"warning"});const g=await(await fetch(`/api/admin/events/${n.id}?user_id=${w()}`,{method:"DELETE"})).json();g.success?(p.success("删除成功"),x()):p.error(g.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),p.error("删除失败"))}};return h(()=>{x()}),(n,e)=>{const g=s("Plus"),V=s("el-icon"),u=s("el-button"),m=s("el-table-column"),R=s("el-tag"),J=s("el-table"),F=s("el-card"),E=s("el-input"),r=s("el-form-item"),c=s("el-option"),M=s("el-select"),C=s("el-input-number"),A=s("el-switch"),T=s("el-date-picker"),H=s("el-button-group"),G=s("el-form"),K=s("el-dialog"),Q=te("loading");return $(),ee("div",ne,[i("div",se,[e[17]||(e[17]=i("h2",null,"赛事管理",-1)),t(u,{type:"primary",onClick:P},{default:o(()=>[t(V,null,{default:o(()=>[t(g)]),_:1}),e[16]||(e[16]=d(" 创建赛事 ",-1))]),_:1})]),t(F,null,{default:o(()=>[le(($(),oe(J,{data:Y.value,stripe:""},{default:o(()=>[t(m,{prop:"id",label:"ID",width:"60"}),t(m,{prop:"title",label:"赛事名称","min-width":"150"}),t(m,{prop:"event_type",label:"类型",width:"100"},{default:o(({row:l})=>[d(U(L[l.event_type]||l.event_type),1)]),_:1}),t(m,{prop:"status",label:"状态",width:"100"},{default:o(({row:l})=>[t(R,{type:N[l.status]},{default:o(()=>[d(U(q[l.status]||l.status),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"开始时间",width:"160"},{default:o(({row:l})=>[d(U(ae(X)(l.event_start)),1)]),_:1}),t(m,{prop:"location",label:"地点",width:"120"}),t(m,{prop:"participant_count",label:"报名人数",width:"100"}),t(m,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[t(u,{size:"small",onClick:W=>S(l)},{default:o(()=>[...e[18]||(e[18]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"danger",onClick:W=>O(l)},{default:o(()=>[...e[19]||(e[19]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,y.value]])]),_:1}),t(K,{modelValue:f.value,"onUpdate:modelValue":e[15]||(e[15]=l=>f.value=l),title:v.value?"编辑赛事":"创建赛事",width:"600px"},{footer:o(()=>[t(u,{onClick:e[14]||(e[14]=l=>f.value=!1)},{default:o(()=>[...e[28]||(e[28]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:j,loading:k.value},{default:o(()=>[...e[29]||(e[29]=[d("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(G,{model:a.value,"label-width":"100px"},{default:o(()=>[t(r,{label:"赛事名称",required:""},{default:o(()=>[t(E,{modelValue:a.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.title=l),placeholder:"请输入赛事名称"},null,8,["modelValue"])]),_:1}),t(r,{label:"赛事类型",required:""},{default:o(()=>[t(M,{modelValue:a.value.event_type,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.event_type=l),placeholder:"请选择类型"},{default:o(()=>[t(c,{label:"单打",value:"singles"}),t(c,{label:"双打",value:"doubles"}),t(c,{label:"团体",value:"team"})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"赛制",required:""},{default:o(()=>[t(M,{modelValue:a.value.event_format,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.event_format=l),placeholder:"请选择赛制"},{default:o(()=>[t(c,{label:"淘汰赛",value:"knockout"}),t(c,{label:"循环赛",value:"round_robin"}),t(c,{label:"小组+淘汰",value:"group_knockout"})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"几局几胜"},{default:o(()=>[i("div",ie,[t(C,{modelValue:a.value.best_of,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.best_of=l),min:1,max:21,placeholder:"局数"},null,8,["modelValue"]),e[20]||(e[20]=i("span",null,"局",-1)),t(C,{modelValue:a.value.games_to_win,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.games_to_win=l),min:1,max:11,placeholder:"胜数"},null,8,["modelValue"]),e[21]||(e[21]=i("span",null,"胜",-1))])]),_:1}),t(r,{label:"计入积分"},{default:o(()=>[t(A,{modelValue:a.value.counts_for_ranking,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.counts_for_ranking=l)},null,8,["modelValue"]),e[22]||(e[22]=i("span",{style:{"margin-left":"10px",color:"#909399"}},"开启后比赛结果将计入用户积分",-1))]),_:1}),t(r,{label:"开始时间",required:""},{default:o(()=>[t(T,{modelValue:a.value.event_start,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.event_start=l),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(r,{label:"地点"},{default:o(()=>[t(E,{modelValue:a.value.location,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.location=l),placeholder:"请输入比赛地点"},null,8,["modelValue"])]),_:1}),t(r,{label:"最大人数"},{default:o(()=>[t(C,{modelValue:a.value.max_participants,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.max_participants=l),min:2,max:256},null,8,["modelValue"])]),_:1}),t(r,{label:"报名截止"},{default:o(()=>[t(T,{modelValue:a.value.registration_end,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.registration_end=l),type:"datetime",placeholder:"选择报名截止时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(r,{label:"赛事说明"},{default:o(()=>[i("div",ue,[i("div",re,[t(H,null,{default:o(()=>[t(u,{size:"small",onClick:e[10]||(e[10]=l=>b("bold"))},{default:o(()=>[...e[23]||(e[23]=[i("strong",null,"B",-1)])]),_:1}),t(u,{size:"small",onClick:e[11]||(e[11]=l=>b("italic"))},{default:o(()=>[...e[24]||(e[24]=[i("em",null,"I",-1)])]),_:1}),t(u,{size:"small",onClick:e[12]||(e[12]=l=>b("underline"))},{default:o(()=>[...e[25]||(e[25]=[i("u",null,"U",-1)])]),_:1})]),_:1}),t(H,{style:{"margin-left":"8px"}},{default:o(()=>[t(u,{size:"small",onClick:e[13]||(e[13]=l=>b("insertUnorderedList"))},{default:o(()=>[...e[26]||(e[26]=[d("列表",-1)])]),_:1}),t(u,{size:"small",onClick:z},{default:o(()=>[...e[27]||(e[27]=[d("图片",-1)])]),_:1})]),_:1})]),i("div",{ref_key:"editorRef",ref:D,class:"editor-content",contenteditable:"true",onInput:B,innerHTML:a.value.description},null,40,de)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ce=Z(me,[["__scopeId","data-v-d460a1b2"]]);export{ce as default};
