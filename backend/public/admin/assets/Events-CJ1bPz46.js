import{f as R}from"./format-JQP6GPa6.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as b,p as X,c as D,o as V,b as _,d as l,w as o,f as s,E as u,q as Z,h as d,s as h,l as $,t as C,m as ee,k as le,z as te}from"./index-CSMk-Sui.js";const ae={class:"page"},oe={class:"page-header"},ne={style:{display:"flex","align-items":"center",gap:"10px"}},se=["src"],ie={key:1,class:"desc-image-placeholder"},ue={__name:"Events",setup(re){const y=b(!1),E=b([]),c=b(!1),v=b(!1),w=b(!1),a=b({title:"",event_type:"singles",event_format:"knockout",best_of:5,games_to_win:3,counts_for_ranking:!0,event_start:"",location:"",max_participants:32,registration_end:"",description:"",description_image:""}),T=n=>{n.success?(a.value.description_image=n.data.url,u.success("图片上传成功")):u.error(n.message||"上传失败")},N={singles:"单打",doubles:"双打",team:"团体"},S={draft:"草稿",registration:"报名中",ongoing:"进行中",finished:"已结束"},q={draft:"info",registration:"warning",ongoing:"success",finished:""},k=()=>JSON.parse(localStorage.getItem("adminUser")||"{}"),x=async()=>{y.value=!0;try{const n=k(),m=await(await fetch(`/api/admin/events?user_id=${n.id}`)).json();m.success&&(E.value=m.data||[])}catch(n){console.error("加载赛事失败:",n),u.error("加载赛事失败")}finally{y.value=!1}},B=()=>{v.value=!1,a.value={title:"",event_type:"singles",event_format:"knockout",best_of:5,games_to_win:3,counts_for_ranking:!0,event_start:"",location:"",max_participants:32,registration_end:"",description:"",description_image:""},c.value=!0},j=n=>{v.value=!0,a.value={...n},c.value=!0},z=async()=>{if(!a.value.title){u.warning("请输入赛事名称");return}if(!a.value.event_start){u.warning("请选择开始时间");return}w.value=!0;try{const n=k(),e=v.value?`/api/admin/events/${a.value.id}`:"/api/admin/events",m=v.value?"PUT":"POST",r=await(await fetch(e,{method:m,headers:{"Content-Type":"application/json"},body:JSON.stringify({...a.value,user_id:n.id,school_id:n.school_id||null})})).json();r.success?(u.success(v.value?"更新成功":"创建成功"),c.value=!1,x()):u.error(r.message||"操作失败")}catch(n){console.error("提交失败:",n),u.error("操作失败")}finally{w.value=!1}},I=async n=>{try{await te.confirm("确定要删除这个赛事吗？","提示",{type:"warning"});const e=k(),f=await(await fetch(`/api/admin/events/${n.id}?user_id=${e.id}`,{method:"DELETE"})).json();f.success?(u.success("删除成功"),x()):u.error(f.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),u.error("删除失败"))}};return X(()=>{x()}),(n,e)=>{const m=s("Plus"),f=s("el-icon"),r=s("el-button"),p=s("el-table-column"),P=s("el-tag"),L=s("el-table"),O=s("el-card"),U=s("el-input"),i=s("el-form-item"),g=s("el-option"),M=s("el-select"),Y=s("el-input-number"),J=s("el-switch"),H=s("el-date-picker"),A=s("el-upload"),F=s("el-form"),G=s("el-dialog"),K=Z("loading");return V(),D("div",ae,[_("div",oe,[e[15]||(e[15]=_("h2",null,"赛事管理",-1)),l(r,{type:"primary",onClick:B},{default:o(()=>[l(f,null,{default:o(()=>[l(m)]),_:1}),e[14]||(e[14]=d(" 创建赛事 ",-1))]),_:1})]),l(O,null,{default:o(()=>[h((V(),$(L,{data:E.value,stripe:""},{default:o(()=>[l(p,{prop:"id",label:"ID",width:"60"}),l(p,{prop:"title",label:"赛事名称","min-width":"150"}),l(p,{prop:"event_type",label:"类型",width:"100"},{default:o(({row:t})=>[d(C(N[t.event_type]||t.event_type),1)]),_:1}),l(p,{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[l(P,{type:q[t.status]},{default:o(()=>[d(C(S[t.status]||t.status),1)]),_:2},1032,["type"])]),_:1}),l(p,{label:"开始时间",width:"160"},{default:o(({row:t})=>[d(C(ee(R)(t.event_start)),1)]),_:1}),l(p,{prop:"location",label:"地点",width:"120"}),l(p,{prop:"participant_count",label:"报名人数",width:"100"}),l(p,{label:"操作",width:"200",fixed:"right"},{default:o(({row:t})=>[l(r,{size:"small",onClick:Q=>j(t)},{default:o(()=>[...e[16]||(e[16]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",onClick:Q=>I(t)},{default:o(()=>[...e[17]||(e[17]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,y.value]])]),_:1}),l(G,{modelValue:c.value,"onUpdate:modelValue":e[13]||(e[13]=t=>c.value=t),title:v.value?"编辑赛事":"创建赛事",width:"600px"},{footer:o(()=>[l(r,{onClick:e[12]||(e[12]=t=>c.value=!1)},{default:o(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:z,loading:w.value},{default:o(()=>[...e[24]||(e[24]=[d("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(F,{model:a.value,"label-width":"100px"},{default:o(()=>[l(i,{label:"赛事名称",required:""},{default:o(()=>[l(U,{modelValue:a.value.title,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.title=t),placeholder:"请输入赛事名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"赛事类型",required:""},{default:o(()=>[l(M,{modelValue:a.value.event_type,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.event_type=t),placeholder:"请选择类型"},{default:o(()=>[l(g,{label:"单打",value:"singles"}),l(g,{label:"双打",value:"doubles"}),l(g,{label:"团体",value:"team"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"赛制",required:""},{default:o(()=>[l(M,{modelValue:a.value.event_format,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.event_format=t),placeholder:"请选择赛制"},{default:o(()=>[l(g,{label:"淘汰赛",value:"knockout"}),l(g,{label:"循环赛",value:"round_robin"}),l(g,{label:"小组+淘汰",value:"group_knockout"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"几局几胜"},{default:o(()=>[_("div",ne,[l(Y,{modelValue:a.value.best_of,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.best_of=t),min:1,max:21},null,8,["modelValue"]),e[18]||(e[18]=_("span",null,"局",-1)),l(Y,{modelValue:a.value.games_to_win,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.games_to_win=t),min:1,max:11},null,8,["modelValue"]),e[19]||(e[19]=_("span",null,"胜",-1))])]),_:1}),l(i,{label:"计入积分"},{default:o(()=>[l(J,{modelValue:a.value.counts_for_ranking,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.counts_for_ranking=t)},null,8,["modelValue"]),e[20]||(e[20]=_("span",{style:{"margin-left":"10px",color:"#909399"}},"开启后比赛结果将计入用户积分",-1))]),_:1}),l(i,{label:"开始时间",required:""},{default:o(()=>[l(H,{modelValue:a.value.event_start,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.event_start=t),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(i,{label:"地点"},{default:o(()=>[l(U,{modelValue:a.value.location,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.location=t),placeholder:"请输入比赛地点"},null,8,["modelValue"])]),_:1}),l(i,{label:"最大人数"},{default:o(()=>[l(Y,{modelValue:a.value.max_participants,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.max_participants=t),min:2,max:256},null,8,["modelValue"])]),_:1}),l(i,{label:"报名截止"},{default:o(()=>[l(H,{modelValue:a.value.registration_end,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.registration_end=t),type:"datetime",placeholder:"选择报名截止时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),l(i,{label:"赛事说明"},{default:o(()=>[l(U,{modelValue:a.value.description,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.description=t),type:"textarea",rows:4,placeholder:"请输入赛事说明"},null,8,["modelValue"])]),_:1}),l(i,{label:"说明图片"},{default:o(()=>[l(A,{class:"desc-image-uploader",action:"/api/upload/file","show-file-list":!1,"on-success":T,accept:"image/*",name:"file"},{default:o(()=>[a.value.description_image?(V(),D("img",{key:0,src:a.value.description_image,class:"desc-image-preview"},null,8,se)):(V(),D("div",ie,[l(f,null,{default:o(()=>[l(m)]),_:1}),e[21]||(e[21]=_("span",null,"上传图片",-1))]))]),_:1}),a.value.description_image?(V(),$(r,{key:0,size:"small",type:"danger",style:{"margin-left":"10px"},onClick:e[11]||(e[11]=t=>a.value.description_image="")},{default:o(()=>[...e[22]||(e[22]=[d("删除图片",-1)])]),_:1})):le("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_e=W(ue,[["__scopeId","data-v-ba26464c"]]);export{_e as default};
