import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,p as F,c as A,o as E,b as U,d as t,w as a,f as n,E as u,q as G,h as d,s as K,l as Q,t as C,z as R}from"./index-BThRipZj.js";const W={class:"page"},X={class:"page-header"},Z={__name:"Events",setup(ee){const b=_(!1),Y=_([]),p=_(!1),m=_(!1),y=_(!1),o=_({title:"",event_type:"singles",event_format:"knockout",event_start:"",location:"",max_participants:32,registration_deadline:"",description:""}),M={singles:"单打",doubles:"双打",team:"团体"},H={draft:"草稿",registration:"报名中",ongoing:"进行中",finished:"已结束"},$={draft:"info",registration:"warning",ongoing:"success",finished:""},V=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,w=async()=>{b.value=!0;try{const e=await(await fetch(`/api/admin/events?user_id=${V()}`)).json();e.success&&(Y.value=e.data||[])}catch(s){console.error("加载赛事失败:",s),u.error("加载赛事失败")}finally{b.value=!1}},h=()=>{m.value=!1,o.value={title:"",event_type:"singles",event_format:"knockout",event_start:"",location:"",max_participants:32,registration_deadline:"",description:""},p.value=!0},T=s=>{m.value=!0,o.value={...s},p.value=!0},q=async()=>{if(!o.value.title){u.warning("请输入赛事名称");return}y.value=!0;try{const s=m.value?`/api/admin/events/${o.value.id}`:"/api/admin/events",e=m.value?"PUT":"POST",g=await(await fetch(s,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({...o.value,user_id:V()})})).json();g.success?(u.success(m.value?"更新成功":"创建成功"),p.value=!1,w()):u.error(g.message||"操作失败")}catch(s){console.error("提交失败:",s),u.error("操作失败")}finally{y.value=!1}},B=async s=>{try{await R.confirm("确定要删除这个赛事吗？","提示",{type:"warning"});const v=await(await fetch(`/api/admin/events/${s.id}?user_id=${V()}`,{method:"DELETE"})).json();v.success?(u.success("删除成功"),w()):u.error(v.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),u.error("删除失败"))}};return F(()=>{w()}),(s,e)=>{const v=n("Plus"),g=n("el-icon"),f=n("el-button"),i=n("el-table-column"),N=n("el-tag"),S=n("el-table"),j=n("el-card"),k=n("el-input"),r=n("el-form-item"),c=n("el-option"),x=n("el-select"),D=n("el-date-picker"),I=n("el-input-number"),P=n("el-form"),z=n("el-dialog"),L=G("loading");return E(),A("div",W,[U("div",X,[e[11]||(e[11]=U("h2",null,"赛事管理",-1)),t(f,{type:"primary",onClick:h},{default:a(()=>[t(g,null,{default:a(()=>[t(v)]),_:1}),e[10]||(e[10]=d(" 创建赛事 ",-1))]),_:1})]),t(j,null,{default:a(()=>[K((E(),Q(S,{data:Y.value,stripe:""},{default:a(()=>[t(i,{prop:"id",label:"ID",width:"60"}),t(i,{prop:"title",label:"赛事名称","min-width":"150"}),t(i,{prop:"event_type",label:"类型",width:"100"},{default:a(({row:l})=>[d(C(M[l.event_type]||l.event_type),1)]),_:1}),t(i,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(N,{type:$[l.status]},{default:a(()=>[d(C(H[l.status]||l.status),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"event_start",label:"开始时间",width:"160"}),t(i,{prop:"location",label:"地点",width:"120"}),t(i,{prop:"participant_count",label:"报名人数",width:"100"}),t(i,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(f,{size:"small",onClick:O=>T(l)},{default:a(()=>[...e[12]||(e[12]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(f,{size:"small",type:"danger",onClick:O=>B(l)},{default:a(()=>[...e[13]||(e[13]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,b.value]])]),_:1}),t(z,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=l=>p.value=l),title:m.value?"编辑赛事":"创建赛事",width:"600px"},{footer:a(()=>[t(f,{onClick:e[8]||(e[8]=l=>p.value=!1)},{default:a(()=>[...e[14]||(e[14]=[d("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:q,loading:y.value},{default:a(()=>[...e[15]||(e[15]=[d("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(P,{model:o.value,"label-width":"100px"},{default:a(()=>[t(r,{label:"赛事名称",required:""},{default:a(()=>[t(k,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.title=l),placeholder:"请输入赛事名称"},null,8,["modelValue"])]),_:1}),t(r,{label:"赛事类型",required:""},{default:a(()=>[t(x,{modelValue:o.value.event_type,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.event_type=l),placeholder:"请选择类型"},{default:a(()=>[t(c,{label:"单打",value:"singles"}),t(c,{label:"双打",value:"doubles"}),t(c,{label:"团体",value:"team"})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"赛制",required:""},{default:a(()=>[t(x,{modelValue:o.value.event_format,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.event_format=l),placeholder:"请选择赛制"},{default:a(()=>[t(c,{label:"淘汰赛",value:"knockout"}),t(c,{label:"循环赛",value:"round_robin"}),t(c,{label:"小组+淘汰",value:"group_knockout"})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"开始时间",required:""},{default:a(()=>[t(D,{modelValue:o.value.event_start,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.event_start=l),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(r,{label:"地点"},{default:a(()=>[t(k,{modelValue:o.value.location,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.location=l),placeholder:"请输入比赛地点"},null,8,["modelValue"])]),_:1}),t(r,{label:"最大人数"},{default:a(()=>[t(I,{modelValue:o.value.max_participants,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.max_participants=l),min:2,max:256},null,8,["modelValue"])]),_:1}),t(r,{label:"报名截止"},{default:a(()=>[t(D,{modelValue:o.value.registration_deadline,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.registration_deadline=l),type:"datetime",placeholder:"选择报名截止时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(r,{label:"赛事说明"},{default:a(()=>[t(k,{modelValue:o.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.description=l),type:"textarea",rows:3,placeholder:"请输入赛事说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ae=J(Z,[["__scopeId","data-v-20300b10"]]);export{ae as default};
