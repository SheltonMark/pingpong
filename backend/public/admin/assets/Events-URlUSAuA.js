import{_ as G,a as w}from"./_plugin-vue_export-helper-BREQrZf2.js";import{r as _,o as J,c as K,a as E,b as M,d as e,w as a,e as n,E as r,f as O,g as d,h as Q,i as R,t as C,j as W}from"./index-sVHU-eVW.js";const X={class:"page"},Z={class:"page-header"},b="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",ee={__name:"Events",setup(te){const g=_(!1),x=_([]),p=_(!1),m=_(!1),V=_(!1),o=_({title:"",event_type:"singles",event_format:"knockout",event_start:"",location:"",max_participants:32,registration_deadline:"",description:""}),U={singles:"单打",doubles:"双打",team:"团体"},$={draft:"草稿",registration:"报名中",ongoing:"进行中",finished:"已结束"},H={draft:"info",registration:"warning",ongoing:"success",finished:""},y=async()=>{g.value=!0;try{const s=await w.get(`${b}/api/events`);s.data.success&&(x.value=s.data.data.list||s.data.data)}catch(s){console.error("加载赛事失败:",s),r.error("加载赛事失败")}finally{g.value=!1}},B=()=>{m.value=!1,o.value={title:"",event_type:"singles",event_format:"knockout",event_start:"",location:"",max_participants:32,registration_deadline:"",description:""},p.value=!0},q=s=>{m.value=!0,o.value={...s},p.value=!0},h=async()=>{if(!o.value.title){r.warning("请输入赛事名称");return}V.value=!0;try{const s=m.value?`${b}/api/admin/events/${o.value.id}`:`${b}/api/admin/events`,t=m.value?"put":"post",f=await w[t](s,o.value);f.data.success?(r.success(m.value?"更新成功":"创建成功"),p.value=!1,y()):r.error(f.data.message||"操作失败")}catch(s){console.error("提交失败:",s),r.error("操作失败")}finally{V.value=!1}},I=async s=>{try{await W.confirm("确定要删除这个赛事吗？","提示",{type:"warning"});const t=await w.delete(`${b}/api/admin/events/${s.id}`);t.data.success?(r.success("删除成功"),y()):r.error(t.data.message||"删除失败")}catch(t){t!=="cancel"&&(console.error("删除失败:",t),r.error("删除失败"))}};return J(()=>{y()}),(s,t)=>{const f=n("Plus"),N=n("el-icon"),c=n("el-button"),i=n("el-table-column"),P=n("el-tag"),z=n("el-table"),A=n("el-card"),k=n("el-input"),u=n("el-form-item"),v=n("el-option"),Y=n("el-select"),D=n("el-date-picker"),L=n("el-input-number"),S=n("el-form"),T=n("el-dialog"),j=O("loading");return E(),K("div",X,[M("div",Z,[t[11]||(t[11]=M("h2",null,"赛事管理",-1)),e(c,{type:"primary",onClick:B},{default:a(()=>[e(N,null,{default:a(()=>[e(f)]),_:1}),t[10]||(t[10]=d(" 创建赛事 ",-1))]),_:1})]),e(A,null,{default:a(()=>[Q((E(),R(z,{data:x.value,stripe:""},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"60"}),e(i,{prop:"title",label:"赛事名称","min-width":"150"}),e(i,{prop:"event_type",label:"类型",width:"100"},{default:a(({row:l})=>[d(C(U[l.event_type]||l.event_type),1)]),_:1}),e(i,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(P,{type:H[l.status]},{default:a(()=>[d(C($[l.status]||l.status),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"event_start",label:"开始时间",width:"160"}),e(i,{prop:"location",label:"地点",width:"120"}),e(i,{prop:"participant_count",label:"报名人数",width:"100"}),e(i,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[e(c,{size:"small",onClick:F=>q(l)},{default:a(()=>[...t[12]||(t[12]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(c,{size:"small",type:"danger",onClick:F=>I(l)},{default:a(()=>[...t[13]||(t[13]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,g.value]])]),_:1}),e(T,{modelValue:p.value,"onUpdate:modelValue":t[9]||(t[9]=l=>p.value=l),title:m.value?"编辑赛事":"创建赛事",width:"600px"},{footer:a(()=>[e(c,{onClick:t[8]||(t[8]=l=>p.value=!1)},{default:a(()=>[...t[14]||(t[14]=[d("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:h,loading:V.value},{default:a(()=>[...t[15]||(t[15]=[d("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(S,{model:o.value,"label-width":"100px"},{default:a(()=>[e(u,{label:"赛事名称",required:""},{default:a(()=>[e(k,{modelValue:o.value.title,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.title=l),placeholder:"请输入赛事名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"赛事类型",required:""},{default:a(()=>[e(Y,{modelValue:o.value.event_type,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.event_type=l),placeholder:"请选择类型"},{default:a(()=>[e(v,{label:"单打",value:"singles"}),e(v,{label:"双打",value:"doubles"}),e(v,{label:"团体",value:"team"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"赛制",required:""},{default:a(()=>[e(Y,{modelValue:o.value.event_format,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.event_format=l),placeholder:"请选择赛制"},{default:a(()=>[e(v,{label:"淘汰赛",value:"knockout"}),e(v,{label:"循环赛",value:"round_robin"}),e(v,{label:"小组+淘汰",value:"group_knockout"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"开始时间",required:""},{default:a(()=>[e(D,{modelValue:o.value.event_start,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.event_start=l),type:"datetime",placeholder:"选择日期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(u,{label:"地点"},{default:a(()=>[e(k,{modelValue:o.value.location,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.location=l),placeholder:"请输入比赛地点"},null,8,["modelValue"])]),_:1}),e(u,{label:"最大人数"},{default:a(()=>[e(L,{modelValue:o.value.max_participants,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.max_participants=l),min:2,max:256},null,8,["modelValue"])]),_:1}),e(u,{label:"报名截止"},{default:a(()=>[e(D,{modelValue:o.value.registration_deadline,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.registration_deadline=l),type:"datetime",placeholder:"选择报名截止时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(u,{label:"赛事说明"},{default:a(()=>[e(k,{modelValue:o.value.description,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.description=l),type:"textarea",rows:3,placeholder:"请输入赛事说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=G(ee,[["__scopeId","data-v-3e583572"]]);export{oe as default};
