import{f as q}from"./format-DoeqoNZs.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as c,p as A,c as h,o as _,b as o,d as t,w as n,f as i,E as x,q as H,F as E,v as K,l as S,s as Q,t as d,h as m,m as R,G as W}from"./index-Bf8p-mK5.js";const X={class:"page"},Y={class:"page-header"},Z={class:"header-actions"},ee={style:{display:"flex","align-items":"center",gap:"8px"}},te={style:{"font-size":"12px",color:"#999"}},ae={style:{display:"flex","align-items":"center",gap:"8px"}},le={style:{"font-size":"12px",color:"#999"}},ne={key:1,style:{color:"#999","font-size":"12px"}},se={style:{"margin-top":"20px","text-align":"right"}},oe={__name:"Invitations",setup(ie){const V=c(!1),j=c([]),k=c([]),f=c(null),g=c(null),b=c(null),y=c("pending"),$=c(1),z=c(0),B={pending:"待处理",accepted:"已接受",rejected:"已拒绝",expired:"已过期"},D={pending:"warning",accepted:"success",rejected:"danger",expired:"info"},C=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,N=async()=>{try{const a=await(await fetch(`/api/admin/events?user_id=${C()}`)).json();a.success&&(k.value=(a.data||[]).filter(l=>l.event_type==="doubles"||l.event_type==="team"))}catch(s){console.error("加载赛事列表失败:",s)}},u=async()=>{V.value=!0;try{let s=`/api/admin/invitations?user_id=${C()}&page=${$.value}`;f.value&&(s+=`&event_id=${f.value}`),g.value&&(s+=`&type=${g.value}`),y.value!=="all"?s+=`&status=${y.value}`:b.value&&(s+=`&status=${b.value}`);const l=await(await fetch(s)).json();l.success&&(j.value=l.data||[],z.value=l.total||0)}catch(s){console.error("加载邀请列表失败:",s),x.error("加载失败")}finally{V.value=!1}},I=async(s,a)=>{const l=a==="accept"?"接受":"拒绝";try{await W.confirm(`确认代为${l}这个邀请吗？这将以被邀请人的身份${l}邀请。`,"提示");const v=await(await fetch(`/api/admin/invitations/${s.id}/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:C()})})).json();v.success?(x.success(`已${l}`),u()):x.error(v.message||"操作失败")}catch(p){p!=="cancel"&&(console.error(`${l}邀请失败:`,p),x.error("操作失败"))}};return A(()=>{N(),u()}),(s,a)=>{const l=i("el-option"),p=i("el-select"),v=i("el-tab-pane"),L=i("el-tabs"),r=i("el-table-column"),w=i("el-tag"),T=i("el-avatar"),U=i("el-button"),M=i("el-table"),O=i("el-pagination"),F=i("el-card"),J=H("loading");return _(),h("div",X,[o("div",Y,[a[5]||(a[5]=o("h2",null,"邀请管理",-1)),o("div",Z,[t(p,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),placeholder:"选择赛事",clearable:"",onChange:u},{default:n(()=>[(_(!0),h(E,null,K(k.value,e=>(_(),S(l,{key:e.id,label:e.title,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(p,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),placeholder:"邀请类型",clearable:"",onChange:u},{default:n(()=>[t(l,{label:"双打邀请",value:"doubles"}),t(l,{label:"团体赛邀请",value:"team"})]),_:1},8,["modelValue"]),t(p,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=e=>b.value=e),placeholder:"状态",clearable:"",onChange:u},{default:n(()=>[t(l,{label:"待处理",value:"pending"}),t(l,{label:"已接受",value:"accepted"}),t(l,{label:"已拒绝",value:"rejected"}),t(l,{label:"已过期",value:"expired"})]),_:1},8,["modelValue"])])]),t(F,null,{default:n(()=>[t(L,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=e=>y.value=e),onTabChange:u},{default:n(()=>[t(v,{label:"待处理",name:"pending"}),t(v,{label:"已接受",name:"accepted"}),t(v,{label:"已拒绝",name:"rejected"}),t(v,{label:"全部",name:"all"})]),_:1},8,["modelValue"]),Q((_(),S(M,{data:j.value,stripe:""},{default:n(()=>[t(r,{prop:"id",label:"ID",width:"60"}),t(r,{label:"赛事","min-width":"150"},{default:n(({row:e})=>[o("div",null,[o("div",null,d(e.event_title),1),t(w,{size:"small",type:e.type==="doubles"?"primary":"success"},{default:n(()=>[m(d(e.type==="doubles"?"双打":"团体"),1)]),_:2},1032,["type"])])]),_:1}),t(r,{label:"邀请人","min-width":"140"},{default:n(({row:e})=>[o("div",ee,[t(T,{size:28,src:e.inviter_avatar},null,8,["src"]),o("div",null,[o("div",null,d(e.inviter_name),1),o("div",te,d(e.inviter_phone),1)])])]),_:1}),t(r,{label:"被邀请人","min-width":"140"},{default:n(({row:e})=>[o("div",ae,[t(T,{size:28,src:e.invitee_avatar},null,8,["src"]),o("div",null,[o("div",null,d(e.invitee_name),1),o("div",le,d(e.invitee_phone),1)])])]),_:1}),t(r,{prop:"message",label:"备注","min-width":"120"},{default:n(({row:e})=>[m(d(e.message||"-"),1)]),_:1}),t(r,{prop:"status",label:"状态",width:"100"},{default:n(({row:e})=>[t(w,{type:D[e.status]},{default:n(()=>[m(d(B[e.status]),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"创建时间",width:"160"},{default:n(({row:e})=>[m(d(R(q)(e.created_at)),1)]),_:1}),t(r,{label:"操作",width:"160",fixed:"right"},{default:n(({row:e})=>[e.status==="pending"?(_(),h(E,{key:0},[t(U,{size:"small",type:"success",onClick:P=>I(e,"accept")},{default:n(()=>[...a[6]||(a[6]=[m("代为接受",-1)])]),_:1},8,["onClick"]),t(U,{size:"small",type:"danger",onClick:P=>I(e,"reject")},{default:n(()=>[...a[7]||(a[7]=[m("代为拒绝",-1)])]),_:1},8,["onClick"])],64)):(_(),h("span",ne,d(e.status==="accepted"?"已接受":e.status==="rejected"?"已拒绝":"已过期"),1))]),_:1})]),_:1},8,["data"])),[[J,V.value]]),o("div",se,[t(O,{"current-page":$.value,"onUpdate:currentPage":a[4]||(a[4]=e=>$.value=e),"page-size":20,total:z.value,layout:"total, prev, pager, next",onCurrentChange:u},null,8,["current-page","total"])])]),_:1})])}}},ue=G(oe,[["__scopeId","data-v-dec68d46"]]);export{ue as default};
