import{a as P}from"./index-B9ygI19o.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as u,i as te,n as ae,c as D,o as $,b as M,d as l,w as t,f as s,E as r,p as oe,h as i,q as ne,l as se,t as w,k as re,y as ie}from"./index-CrY6qIOu.js";const ue={class:"page"},de={class:"page-header"},pe={key:0,class:"current-file"},_="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",ce={__name:"Learning",setup(me){const V=u(!1),U=u([]),v=u("video"),p=u(!1),c=u(!1),k=u(!1),L=u(null),g=u([]),n=u({title:"",type:"video",url:"",original_name:"",description:""}),N={video:"视频",ppt:"PPT",document:"文档"},q={video:"danger",ppt:"warning",document:""},z=te(()=>`${_}/api/upload/file`),h=a=>a?a.startsWith("http")?a:`${_}${a}`:"",F=a=>a.size/1024/1024<100?!0:(r.error("文件大小不能超过 100MB"),!1),I=a=>{a.success?(n.value.url=a.data.url,n.value.original_name=a.data.originalName,r.success("文件上传成功")):r.error(a.message||"上传失败")},S=()=>{r.error("文件上传失败")},b=async()=>{V.value=!0;try{const a=await P.get(`${_}/api/admin/learning`);if(a.data.success){const e=a.data.data||[];U.value=e.filter(m=>m.type===v.value)}}catch(a){console.error("加载学习资料失败:",a),r.error("加载失败")}finally{V.value=!1}},A=()=>{c.value=!1,n.value={title:"",type:v.value,url:"",original_name:"",description:""},g.value=[],p.value=!0},R=a=>{c.value=!0,n.value={...a},g.value=[],p.value=!0},W=async()=>{if(!n.value.title){r.warning("请填写标题");return}if(!n.value.url){r.warning("请上传文件");return}k.value=!0;try{const a=c.value?`${_}/api/admin/learning/${n.value.id}`:`${_}/api/admin/learning`,e=c.value?"put":"post",m=await P[e](a,n.value);m.data.success?(r.success(c.value?"更新成功":"添加成功"),p.value=!1,b()):r.error(m.data.message||"操作失败")}catch(a){console.error("提交失败:",a),r.error("操作失败")}finally{k.value=!1}},j=async a=>{try{await ie.confirm("确定要删除这个资料吗？","提示",{type:"warning"});const e=await P.delete(`${_}/api/admin/learning/${a.id}`);e.data.success?(r.success("删除成功"),b()):r.error(e.data.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),r.error("删除失败"))}};return ae(()=>{b()}),(a,e)=>{const m=s("Plus"),G=s("el-icon"),f=s("el-button"),C=s("el-tab-pane"),H=s("el-tabs"),d=s("el-table-column"),B=s("el-tag"),E=s("el-link"),J=s("el-table"),K=s("el-card"),T=s("el-input"),y=s("el-form-item"),x=s("el-option"),O=s("el-select"),Q=s("el-upload"),X=s("el-form"),Y=s("el-dialog"),Z=oe("loading");return $(),D("div",ue,[M("div",de,[e[7]||(e[7]=M("h2",null,"学习资料管理",-1)),l(f,{type:"primary",onClick:A},{default:t(()=>[l(G,null,{default:t(()=>[l(m)]),_:1}),e[6]||(e[6]=i(" 添加资料 ",-1))]),_:1})]),l(K,null,{default:t(()=>[l(H,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),onTabChange:b},{default:t(()=>[l(C,{label:"视频",name:"video"}),l(C,{label:"PPT",name:"ppt"}),l(C,{label:"文档",name:"document"})]),_:1},8,["modelValue"]),ne(($(),se(J,{data:U.value,stripe:""},{default:t(()=>[l(d,{prop:"id",label:"ID",width:"60"}),l(d,{prop:"title",label:"标题","min-width":"200"}),l(d,{prop:"type",label:"类型",width:"100"},{default:t(({row:o})=>[l(B,{type:q[o.type]},{default:t(()=>[i(w(N[o.type]),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"文件","min-width":"200"},{default:t(({row:o})=>[l(E,{href:h(o.url),target:"_blank",type:"primary"},{default:t(()=>[i(w(o.original_name||"查看文件"),1)]),_:2},1032,["href"])]),_:1}),l(d,{prop:"view_count",label:"浏览量",width:"80"}),l(d,{prop:"status",label:"状态",width:"80"},{default:t(({row:o})=>[l(B,{type:o.status==="active"?"success":"info"},{default:t(()=>[i(w(o.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"created_at",label:"创建时间",width:"160"}),l(d,{label:"操作",width:"150",fixed:"right"},{default:t(({row:o})=>[l(f,{size:"small",onClick:ee=>R(o)},{default:t(()=>[...e[8]||(e[8]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(f,{size:"small",type:"danger",onClick:ee=>j(o)},{default:t(()=>[...e[9]||(e[9]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,V.value]])]),_:1}),l(Y,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),title:c.value?"编辑资料":"添加资料",width:"500px"},{footer:t(()=>[l(f,{onClick:e[4]||(e[4]=o=>p.value=!1)},{default:t(()=>[...e[13]||(e[13]=[i("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:W,loading:k.value},{default:t(()=>[...e[14]||(e[14]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(X,{model:n.value,"label-width":"80px"},{default:t(()=>[l(y,{label:"标题",required:""},{default:t(()=>[l(T,{modelValue:n.value.title,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.title=o),placeholder:"请输入资料标题"},null,8,["modelValue"])]),_:1}),l(y,{label:"类型",required:""},{default:t(()=>[l(O,{modelValue:n.value.type,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.type=o),placeholder:"请选择类型"},{default:t(()=>[l(x,{label:"视频",value:"video"}),l(x,{label:"PPT",value:"ppt"}),l(x,{label:"文档",value:"document"})]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"上传文件",required:""},{default:t(()=>[l(Q,{ref_key:"uploadRef",ref:L,class:"upload-demo",action:z.value,limit:1,"on-success":I,"on-error":S,"before-upload":F,"file-list":g.value,"auto-upload":!0,name:"file"},{tip:t(()=>[...e[11]||(e[11]=[M("div",{class:"el-upload__tip"}," 支持视频、PPT、PDF、Word文档，最大100MB ",-1)])]),default:t(()=>[l(f,{type:"primary"},{default:t(()=>[...e[10]||(e[10]=[i("选择文件",-1)])]),_:1})]),_:1},8,["action","file-list"]),n.value.url&&!g.value.length?($(),D("div",pe,[e[12]||(e[12]=i(" 当前文件：",-1)),l(E,{href:h(n.value.url),target:"_blank",type:"primary"},{default:t(()=>[i(w(n.value.original_name||"查看"),1)]),_:1},8,["href"])])):re("",!0)]),_:1}),l(y,{label:"描述"},{default:t(()=>[l(T,{modelValue:n.value.description,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.description=o),type:"textarea",rows:3,placeholder:"请输入资料描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ge=le(ce,[["__scopeId","data-v-3c5b8bf0"]]);export{ge as default};
