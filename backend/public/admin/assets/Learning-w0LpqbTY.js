import{a as C}from"./index-B9ygI19o.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,n as K,c as O,o as U,b as B,d as l,w as a,f as o,E as i,p as Q,h as u,q as W,l as X,t as P,y as Y}from"./index-Cf1Abx-S.js";const Z={class:"page"},ee={class:"page-header"},g="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",le={__name:"Learning",setup(te){const y=d(!1),$=d([]),v=d("video"),p=d(!1),c=d(!1),V=d(!1),n=d({title:"",type:"video",url:"",description:""}),E={video:"视频",ppt:"PPT",document:"文档"},M={video:"danger",ppt:"warning",document:""},f=async()=>{y.value=!0;try{const s=await C.get(`${g}/api/admin/learning`);if(s.data.success){const e=s.data.data||[];$.value=e.filter(m=>m.type===v.value)}}catch(s){console.error("加载学习资料失败:",s),i.error("加载失败")}finally{y.value=!1}},T=()=>{c.value=!1,n.value={title:"",type:v.value,url:"",description:""},p.value=!0},D=s=>{c.value=!0,n.value={...s},p.value=!0},q=async()=>{if(!n.value.title||!n.value.url){i.warning("请填写标题和链接");return}V.value=!0;try{const s=c.value?`${g}/api/admin/learning/${n.value.id}`:`${g}/api/admin/learning`,e=c.value?"put":"post",m=await C[e](s,n.value);m.data.success?(i.success(c.value?"更新成功":"添加成功"),p.value=!1,f()):i.error(m.data.message||"操作失败")}catch(s){console.error("提交失败:",s),i.error("操作失败")}finally{V.value=!1}},L=async s=>{try{await Y.confirm("确定要删除这个资料吗？","提示",{type:"warning"});const e=await C.delete(`${g}/api/admin/learning/${s.id}`);e.data.success?(i.success("删除成功"),f()):i.error(e.data.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),i.error("删除失败"))}};return K(()=>{f()}),(s,e)=>{const m=o("Plus"),I=o("el-icon"),_=o("el-button"),w=o("el-tab-pane"),N=o("el-tabs"),r=o("el-table-column"),h=o("el-tag"),z=o("el-link"),A=o("el-table"),S=o("el-card"),k=o("el-input"),b=o("el-form-item"),x=o("el-option"),F=o("el-select"),R=o("el-form"),j=o("el-dialog"),G=Q("loading");return U(),O("div",Z,[B("div",ee,[e[8]||(e[8]=B("h2",null,"学习资料管理",-1)),l(_,{type:"primary",onClick:T},{default:a(()=>[l(I,null,{default:a(()=>[l(m)]),_:1}),e[7]||(e[7]=u(" 添加资料 ",-1))]),_:1})]),l(S,null,{default:a(()=>[l(N,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),onTabChange:f},{default:a(()=>[l(w,{label:"视频",name:"video"}),l(w,{label:"PPT",name:"ppt"}),l(w,{label:"文档",name:"document"})]),_:1},8,["modelValue"]),W((U(),X(A,{data:$.value,stripe:""},{default:a(()=>[l(r,{prop:"id",label:"ID",width:"60"}),l(r,{prop:"title",label:"标题","min-width":"200"}),l(r,{prop:"type",label:"类型",width:"100"},{default:a(({row:t})=>[l(h,{type:M[t.type]},{default:a(()=>[u(P(E[t.type]),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"url",label:"链接","min-width":"200"},{default:a(({row:t})=>[l(z,{href:t.url,target:"_blank",type:"primary"},{default:a(()=>[u(P(t.url),1)]),_:2},1032,["href"])]),_:1}),l(r,{prop:"view_count",label:"浏览量",width:"80"}),l(r,{prop:"status",label:"状态",width:"80"},{default:a(({row:t})=>[l(h,{type:t.status==="active"?"success":"info"},{default:a(()=>[u(P(t.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"created_at",label:"创建时间",width:"160"}),l(r,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(_,{size:"small",onClick:H=>D(t)},{default:a(()=>[...e[9]||(e[9]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"danger",onClick:H=>L(t)},{default:a(()=>[...e[10]||(e[10]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,y.value]])]),_:1}),l(j,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),title:c.value?"编辑资料":"添加资料",width:"500px"},{footer:a(()=>[l(_,{onClick:e[5]||(e[5]=t=>p.value=!1)},{default:a(()=>[...e[11]||(e[11]=[u("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:q,loading:V.value},{default:a(()=>[...e[12]||(e[12]=[u("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(R,{model:n.value,"label-width":"80px"},{default:a(()=>[l(b,{label:"标题",required:""},{default:a(()=>[l(k,{modelValue:n.value.title,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.title=t),placeholder:"请输入资料标题"},null,8,["modelValue"])]),_:1}),l(b,{label:"类型",required:""},{default:a(()=>[l(F,{modelValue:n.value.type,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.type=t),placeholder:"请选择类型"},{default:a(()=>[l(x,{label:"视频",value:"video"}),l(x,{label:"PPT",value:"ppt"}),l(x,{label:"文档",value:"document"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"链接",required:""},{default:a(()=>[l(k,{modelValue:n.value.url,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.url=t),placeholder:"请输入资料链接（视频/文件URL）"},null,8,["modelValue"])]),_:1}),l(b,{label:"描述"},{default:a(()=>[l(k,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"请输入资料描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},se=J(le,[["__scopeId","data-v-45c9bd10"]]);export{se as default};
