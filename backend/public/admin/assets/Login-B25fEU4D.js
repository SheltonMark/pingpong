import{r as m,a as y,c as b,o as v,b as f,d as s,w as r,e as x,f as t,u as S,g as V,h as N,E as p,n as k}from"./index-CvYCLO8z.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"login-container"},O={class:"login-box"},I={__name:"Login",setup(J){const c=S(),u=m(null),n=m(!1),a=y({phone:"",password:""}),g={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}]},l=async()=>{if(await u.value.validate().catch(()=>!1)){n.value=!0;try{const o=await(await fetch("/api/admin/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();o.success?(localStorage.setItem("adminUser",JSON.stringify(o.data.user)),localStorage.setItem("adminRoles",JSON.stringify(o.data.roles)),localStorage.setItem("adminPermissions",JSON.stringify(o.data.permissions)),p.success("登录成功"),await k(),o.data.needChangePassword?c.replace("/change-password?first=1"):c.replace("/dashboard")):p.error(o.message||"登录失败")}catch(e){console.error("Login error:",e),p.error("登录失败，请重试")}finally{n.value=!1}}};return(_,e)=>{const o=t("el-input"),i=t("el-form-item"),h=t("el-button"),w=t("el-form");return v(),b("div",L,[f("div",O,[e[3]||(e[3]=f("h2",{class:"title"},"校乒网管理后台",-1)),s(w,{model:a,rules:g,ref_key:"formRef",ref:u,onSubmit:x(l,["prevent"])},{default:r(()=>[s(i,{prop:"phone"},{default:r(()=>[s(o,{modelValue:a.phone,"onUpdate:modelValue":e[0]||(e[0]=d=>a.phone=d),placeholder:"手机号","prefix-icon":"User",size:"large"},null,8,["modelValue"])]),_:1}),s(i,{prop:"password"},{default:r(()=>[s(o,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=d=>a.password=d),type:"password",placeholder:"密码","prefix-icon":"Lock",size:"large","show-password":"",onKeyup:V(l,["enter"])},null,8,["modelValue"])]),_:1}),s(i,null,{default:r(()=>[s(h,{type:"primary",size:"large",loading:n.value,onClick:l,class:"login-btn"},{default:r(()=>[...e[2]||(e[2]=[N(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},U=C(I,[["__scopeId","data-v-2c3a4b74"]]);export{U as default};
