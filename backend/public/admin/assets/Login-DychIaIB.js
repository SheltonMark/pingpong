import{r as c,a as y,c as v,o as b,b as f,d as o,w as r,e as S,f as a,u as V,g as x,h as N,E as p}from"./index-Dv_Uxel_.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";const C={class:"login-container"},L={class:"login-box"},O={__name:"Login",setup(I){const u=V(),m=c(null),n=c(!1),t=y({phone:"",password:""}),g={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}]},l=async()=>{if(await m.value.validate().catch(()=>!1)){n.value=!0;try{const s=await(await fetch("/api/admin/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();s.success?(localStorage.setItem("adminUser",JSON.stringify(s.data.user)),localStorage.setItem("adminRoles",JSON.stringify(s.data.roles)),localStorage.setItem("adminPermissions",JSON.stringify(s.data.permissions)),p.success("登录成功"),s.data.needChangePassword?u.push("/change-password?first=1"):u.push("/events")):p.error(s.message||"登录失败")}catch(e){console.error("Login error:",e),p.error("登录失败，请重试")}finally{n.value=!1}}};return(_,e)=>{const s=a("el-input"),i=a("el-form-item"),h=a("el-button"),w=a("el-form");return b(),v("div",C,[f("div",L,[e[3]||(e[3]=f("h2",{class:"title"},"校乒网管理后台",-1)),o(w,{model:t,rules:g,ref_key:"formRef",ref:m,onSubmit:S(l,["prevent"])},{default:r(()=>[o(i,{prop:"phone"},{default:r(()=>[o(s,{modelValue:t.phone,"onUpdate:modelValue":e[0]||(e[0]=d=>t.phone=d),placeholder:"手机号","prefix-icon":"User",size:"large"},null,8,["modelValue"])]),_:1}),o(i,{prop:"password"},{default:r(()=>[o(s,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=d=>t.password=d),type:"password",placeholder:"密码","prefix-icon":"Lock",size:"large","show-password":"",onKeyup:x(l,["enter"])},null,8,["modelValue"])]),_:1}),o(i,null,{default:r(()=>[o(h,{type:"primary",size:"large",loading:n.value,onClick:l,style:{width:"100%"}},{default:r(()=>[...e[2]||(e[2]=[N(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},U=k(O,[["__scopeId","data-v-c93aed08"]]);export{U as default};
