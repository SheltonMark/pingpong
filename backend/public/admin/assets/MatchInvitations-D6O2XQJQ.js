import{f as I}from"./format-DoeqoNZs.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as x,a as N,p as J,c as y,o as d,b as _,d as a,w as s,f as r,E as g,q as O,F as q,v as G,l as h,s as R,t as u,k as v,m as B,h as m,G as A}from"./index-CFDikFN1.js";const H={class:"page"},K={class:"filter-row"},Q={class:"author-cell"},W={class:"location-cell"},X={key:0},Y={key:1},Z={class:"pagination"},ee={__name:"MatchInvitations",setup(te){const k=x(!1),z=x([]),S=x([]),i=N({status:"",standalone:"",school_id:""}),c=N({page:1,limit:20,total:0}),C=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,p=async()=>{k.value=!0;try{const l=new URLSearchParams({user_id:C(),page:c.page,limit:c.limit});i.status&&l.append("status",i.status),i.standalone&&l.append("standalone",i.standalone),i.school_id&&l.append("school_id",i.school_id);const o=await(await fetch(`/api/admin/match-invitations?${l}`)).json();o.success?(z.value=o.data.list||[],c.total=o.data.total||0):g.error(o.message||"åŠ è½½å¤±è´¥")}catch(l){console.error("åŠ è½½çº¦çƒå¤±è´¥:",l),g.error("åŠ è½½å¤±è´¥")}finally{k.value=!1}},D=async()=>{try{const t=await(await fetch(`/api/admin/schools?user_id=${C()}`)).json();t.success&&(S.value=t.data||[])}catch(l){console.error("åŠ è½½å­¦æ ¡åˆ—è¡¨å¤±è´¥:",l)}},V=async(l,t)=>{const f={open:"æ¢å¤",cancelled:"å–æ¶ˆ",finished:"ç»“æŸ"}[t];try{await A.confirm(`ç¡®å®šè¦${f}è¿™ä¸ªçº¦çƒå—ï¼Ÿ`,"æç¤º",{type:t==="cancelled"?"warning":"info"});const b=await(await fetch(`/api/admin/match-invitations/${l.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t,user_id:C()})})).json();b.success?(g.success(`å·²${f}`),p()):g.error(b.message||"æ“ä½œå¤±è´¥")}catch(n){n!=="cancel"&&(console.error("æ›´æ–°çŠ¶æ€å¤±è´¥:",n),g.error("æ“ä½œå¤±è´¥"))}},L=l=>({open:"success",full:"warning",ongoing:"primary",finished:"info",cancelled:"danger"})[l]||"info",M=l=>({open:"å¼€æ”¾ä¸­",full:"å·²æ»¡å‘˜",ongoing:"è¿›è¡Œä¸­",finished:"å·²ç»“æŸ",cancelled:"å·²å–æ¶ˆ"})[l]||l;return J(()=>{p(),D()}),(l,t)=>{const o=r("el-option"),f=r("el-select"),n=r("el-table-column"),b=r("el-avatar"),U=r("el-tag"),w=r("el-button"),T=r("el-table"),j=r("el-pagination"),E=r("el-card"),P=O("loading");return d(),y("div",H,[t[8]||(t[8]=_("div",{class:"page-header"},[_("h2",null,"çº¦çƒç®¡ç†")],-1)),_("div",K,[a(f,{modelValue:i.status,"onUpdate:modelValue":t[0]||(t[0]=e=>i.status=e),placeholder:"çŠ¶æ€ç­›é€‰",clearable:"",onChange:p,style:{width:"150px"}},{default:s(()=>[a(o,{label:"å…¨éƒ¨çŠ¶æ€",value:""}),a(o,{label:"å¼€æ”¾ä¸­",value:"open"}),a(o,{label:"å·²æ»¡å‘˜",value:"full"}),a(o,{label:"è¿›è¡Œä¸­",value:"ongoing"}),a(o,{label:"å·²ç»“æŸ",value:"finished"}),a(o,{label:"å·²å–æ¶ˆ",value:"cancelled"})]),_:1},8,["modelValue"]),a(f,{modelValue:i.standalone,"onUpdate:modelValue":t[1]||(t[1]=e=>i.standalone=e),placeholder:"ç±»åž‹ç­›é€‰",clearable:"",onChange:p,style:{width:"150px"}},{default:s(()=>[a(o,{label:"å…¨éƒ¨",value:""}),a(o,{label:"ç‹¬ç«‹çº¦çƒ",value:"true"}),a(o,{label:"å…³è”å¸–å­",value:"false"})]),_:1},8,["modelValue"]),a(f,{modelValue:i.school_id,"onUpdate:modelValue":t[2]||(t[2]=e=>i.school_id=e),placeholder:"å­¦æ ¡ç­›é€‰",clearable:"",filterable:"",onChange:p,style:{width:"200px"}},{default:s(()=>[(d(!0),y(q,null,G(S.value,e=>(d(),h(o,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a(E,null,{default:s(()=>[R((d(),h(T,{data:z.value,stripe:""},{default:s(()=>[a(n,{prop:"id",label:"ID",width:"60"}),a(n,{label:"å‘èµ·äºº",width:"150"},{default:s(({row:e})=>[_("div",Q,[a(b,{src:e.creator_avatar,size:32},null,8,["src"]),_("span",null,u(e.creator_name||"æœªçŸ¥ç”¨æˆ·"),1)])]),_:1}),a(n,{prop:"title",label:"æ ‡é¢˜","min-width":"150"}),a(n,{label:"æ—¶é—´åœ°ç‚¹","min-width":"200"},{default:s(({row:e})=>[_("div",W,[e.location?(d(),y("p",X,"ðŸ“ "+u(e.location),1)):v("",!0),e.scheduled_time?(d(),y("p",Y,"ðŸ• "+u(B(I)(e.scheduled_time)),1)):v("",!0)])]),_:1}),a(n,{label:"å‚ä¸Žäººæ•°",width:"100"},{default:s(({row:e})=>[m(u(e.participant_count||1)+"/"+u(e.max_participants),1)]),_:1}),a(n,{prop:"school_name",label:"å­¦æ ¡",width:"120"}),a(n,{label:"ç±»åž‹",width:"100"},{default:s(({row:e})=>[a(U,{type:e.post_id?"primary":"info",size:"small"},{default:s(()=>[m(u(e.post_id?"å…³è”å¸–å­":"ç‹¬ç«‹çº¦çƒ"),1)]),_:2},1032,["type"])]),_:1}),a(n,{label:"çŠ¶æ€",width:"90"},{default:s(({row:e})=>[a(U,{type:L(e.status),size:"small"},{default:s(()=>[m(u(M(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(n,{prop:"created_at",label:"åˆ›å»ºæ—¶é—´",width:"160"},{default:s(({row:e})=>[m(u(B(I)(e.created_at)),1)]),_:1}),a(n,{label:"æ“ä½œ",width:"150",fixed:"right"},{default:s(({row:e})=>[e.status==="open"||e.status==="full"?(d(),h(w,{key:0,size:"small",type:"warning",onClick:$=>V(e,"cancelled")},{default:s(()=>[...t[5]||(t[5]=[m(" å–æ¶ˆ ",-1)])]),_:1},8,["onClick"])):v("",!0),e.status==="cancelled"?(d(),h(w,{key:1,size:"small",type:"success",onClick:$=>V(e,"open")},{default:s(()=>[...t[6]||(t[6]=[m(" æ¢å¤ ",-1)])]),_:1},8,["onClick"])):v("",!0),e.status==="open"||e.status==="full"?(d(),h(w,{key:2,size:"small",type:"primary",onClick:$=>V(e,"finished")},{default:s(()=>[...t[7]||(t[7]=[m(" ç»“æŸ ",-1)])]),_:1},8,["onClick"])):v("",!0)]),_:1})]),_:1},8,["data"])),[[P,k.value]]),_("div",Z,[a(j,{"current-page":c.page,"onUpdate:currentPage":t[3]||(t[3]=e=>c.page=e),"page-size":c.limit,"onUpdate:pageSize":t[4]||(t[4]=e=>c.limit=e),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])])]),_:1})])}}},oe=F(ee,[["__scopeId","data-v-dd708219"]]);export{oe as default};
