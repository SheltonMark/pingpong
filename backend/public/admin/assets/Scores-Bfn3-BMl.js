import{_ as O,a as b}from"./_plugin-vue_export-helper-BREQrZf2.js";import{r as m,o as Q,c as $,a as y,b as _,d as a,w as s,e as o,E as i,f as R,h as W,i as M,n as S,t as p,g as r,F as T,j as D}from"./index-sVHU-eVW.js";const X={class:"page"},g="https://express-lksv-207842-4-1391867763.sh.run.tcloudbase.com",Y={__name:"Scores",setup(Z){const k=m(!1),B=m([]),w=m("pending"),V=m(!1),f=m(!1),n=m({id:null,player1_id:null,player1_name:"",player2_id:null,player2_name:"",score:"",winner_id:null}),E={pending:"待审核",confirmed:"已确认",disputed:"有争议"},U={pending:"warning",confirmed:"success",disputed:"danger"},v=async()=>{k.value=!0;try{const t=await b.get(`${g}/api/admin/matches`,{params:{status:w.value}});t.data.success&&(B.value=t.data.data.list||t.data.data)}catch(t){console.error("加载比赛失败:",t),i.error("加载失败")}finally{k.value=!1}},h=async t=>{try{await D.confirm("确认这场比赛的成绩吗？","提示");const e=await b.post(`${g}/api/admin/matches/${t.id}/confirm`);e.data.success?(i.success("成绩已确认"),v()):i.error(e.data.message||"操作失败")}catch(e){e!=="cancel"&&(console.error("确认失败:",e),i.error("操作失败"))}},F=async t=>{try{const{value:e}=await D.prompt("请输入争议原因","标记争议",{confirmButtonText:"确定",cancelButtonText:"取消"}),c=await b.post(`${g}/api/admin/matches/${t.id}/dispute`,{reason:e});c.data.success?(i.success("已标记争议"),v()):i.error(c.data.message||"操作失败")}catch(e){e!=="cancel"&&console.error("标记失败:",e)}},I=t=>{n.value={id:t.id,player1_id:t.player1_id,player1_name:t.player1_name,player2_id:t.player2_id,player2_name:t.player2_name,score:t.score,winner_id:t.winner_id},f.value=!0},N=async()=>{if(!n.value.score||!n.value.winner_id){i.warning("请填写完整信息");return}V.value=!0;try{const t=await b.put(`${g}/api/admin/matches/${n.value.id}`,{score:n.value.score,winner_id:n.value.winner_id});t.data.success?(i.success("比分已更新"),f.value=!1,v()):i.error(t.data.message||"更新失败")}catch(t){console.error("更新失败:",t),i.error("更新失败")}finally{V.value=!1}};return Q(()=>{v()}),(t,e)=>{const c=o("el-tab-pane"),A=o("el-tabs"),d=o("el-table-column"),j=o("el-tag"),u=o("el-button"),L=o("el-table"),P=o("el-card"),x=o("el-form-item"),q=o("el-input"),z=o("el-radio"),G=o("el-radio-group"),H=o("el-form"),J=o("el-dialog"),K=R("loading");return y(),$("div",X,[e[13]||(e[13]=_("div",{class:"page-header"},[_("h2",null,"成绩审核")],-1)),a(P,null,{default:s(()=>[a(A,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),onTabChange:v},{default:s(()=>[a(c,{label:"待审核",name:"pending"}),a(c,{label:"已审核",name:"confirmed"}),a(c,{label:"有争议",name:"disputed"})]),_:1},8,["modelValue"]),W((y(),M(L,{data:B.value,stripe:""},{default:s(()=>[a(d,{prop:"id",label:"ID",width:"60"}),a(d,{prop:"event_title",label:"赛事","min-width":"120"}),a(d,{prop:"round_name",label:"轮次",width:"80"}),a(d,{label:"比赛双方","min-width":"200"},{default:s(({row:l})=>[_("span",{class:S({winner:l.winner_id===l.player1_id})},p(l.player1_name),3),e[5]||(e[5]=_("span",{style:{margin:"0 8px"}},"vs",-1)),_("span",{class:S({winner:l.winner_id===l.player2_id})},p(l.player2_name),3)]),_:1}),a(d,{prop:"score",label:"比分",width:"100"}),a(d,{prop:"status",label:"状态",width:"100"},{default:s(({row:l})=>[a(j,{type:U[l.status]},{default:s(()=>[r(p(E[l.status]),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"created_at",label:"录入时间",width:"160"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:s(({row:l})=>[l.status==="pending"?(y(),$(T,{key:0},[a(u,{size:"small",type:"success",onClick:C=>h(l)},{default:s(()=>[...e[6]||(e[6]=[r("确认",-1)])]),_:1},8,["onClick"]),a(u,{size:"small",type:"warning",onClick:C=>F(l)},{default:s(()=>[...e[7]||(e[7]=[r("标记争议",-1)])]),_:1},8,["onClick"])],64)):l.status==="disputed"?(y(),$(T,{key:1},[a(u,{size:"small",onClick:C=>I(l)},{default:s(()=>[...e[8]||(e[8]=[r("修改比分",-1)])]),_:1},8,["onClick"]),a(u,{size:"small",type:"success",onClick:C=>h(l)},{default:s(()=>[...e[9]||(e[9]=[r("确认",-1)])]),_:1},8,["onClick"])],64)):(y(),M(u,{key:2,size:"small",disabled:""},{default:s(()=>[...e[10]||(e[10]=[r("已审核",-1)])]),_:1}))]),_:1})]),_:1},8,["data"])),[[K,k.value]])]),_:1}),a(J,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),title:"修改比分",width:"400px"},{footer:s(()=>[a(u,{onClick:e[3]||(e[3]=l=>f.value=!1)},{default:s(()=>[...e[11]||(e[11]=[r("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:N,loading:V.value},{default:s(()=>[...e[12]||(e[12]=[r("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(H,{model:n.value,"label-width":"80px"},{default:s(()=>[a(x,{label:"比赛"},{default:s(()=>[_("span",null,p(n.value.player1_name)+" vs "+p(n.value.player2_name),1)]),_:1}),a(x,{label:"比分"},{default:s(()=>[a(q,{modelValue:n.value.score,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.score=l),placeholder:"如: 3:2"},null,8,["modelValue"])]),_:1}),a(x,{label:"胜者"},{default:s(()=>[a(G,{modelValue:n.value.winner_id,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.winner_id=l)},{default:s(()=>[a(z,{label:n.value.player1_id},{default:s(()=>[r(p(n.value.player1_name),1)]),_:1},8,["label"]),a(z,{label:n.value.player2_id},{default:s(()=>[r(p(n.value.player2_name),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},le=O(Y,[["__scopeId","data-v-fb799ac8"]]);export{le as default};
