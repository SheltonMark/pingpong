import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as m,p as K,c as x,o as v,b as _,d as a,w as t,f as o,E as i,q as Q,s as R,l as j,y as z,t as p,h as r,F as B,z as N}from"./index-BhydzvWF.js";const W={class:"page"},X={__name:"Scores",setup(Y){const w=m(!1),S=m([]),C=m("pending"),k=m(!1),f=m(!1),s=m({id:null,player1_id:null,player1_name:"",player2_id:null,player2_name:"",score:"",winner_id:null}),U={pending:"待审核",confirmed:"已确认",disputed:"有争议"},M={pending:"warning",confirmed:"success",disputed:"danger"},b=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,y=async()=>{w.value=!0;try{const e=await(await fetch(`/api/admin/matches?user_id=${b()}&status=${C.value}`)).json();e.success&&(S.value=e.data||[])}catch(n){console.error("加载比赛失败:",n),i.error("加载失败")}finally{w.value=!1}},T=async n=>{try{await N.confirm("确认这场比赛的成绩吗？","提示");const u=await(await fetch(`/api/admin/matches/${n.id}/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:b()})})).json();u.success?(i.success("成绩已确认"),y()):i.error(u.message||"操作失败")}catch(e){e!=="cancel"&&(console.error("确认失败:",e),i.error("操作失败"))}},O=async n=>{try{const{value:e}=await N.prompt("请输入争议原因","标记争议",{confirmButtonText:"确定",cancelButtonText:"取消"}),g=await(await fetch(`/api/admin/matches/${n.id}/dispute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:e,user_id:b()})})).json();g.success?(i.success("已标记争议"),y()):i.error(g.message||"操作失败")}catch(e){e!=="cancel"&&console.error("标记失败:",e)}},D=n=>{s.value={id:n.id,player1_id:n.player1_id,player1_name:n.player1_name,player2_id:n.player2_id,player2_name:n.player2_name,score:n.score,winner_id:n.winner_id},f.value=!0},E=async()=>{if(!s.value.score||!s.value.winner_id){i.warning("请填写完整信息");return}k.value=!0;try{const e=await(await fetch(`/api/admin/matches/${s.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:s.value.score,winner_id:s.value.winner_id,user_id:b()})})).json();e.success?(i.success("比分已更新"),f.value=!1,y()):i.error(e.message||"更新失败")}catch(n){console.error("更新失败:",n),i.error("更新失败")}finally{k.value=!1}};return K(()=>{y()}),(n,e)=>{const u=o("el-tab-pane"),g=o("el-tabs"),d=o("el-table-column"),I=o("el-tag"),c=o("el-button"),J=o("el-table"),F=o("el-card"),V=o("el-form-item"),P=o("el-input"),$=o("el-radio"),q=o("el-radio-group"),L=o("el-form"),A=o("el-dialog"),G=Q("loading");return v(),x("div",W,[e[13]||(e[13]=_("div",{class:"page-header"},[_("h2",null,"成绩审核")],-1)),a(F,null,{default:t(()=>[a(g,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),onTabChange:y},{default:t(()=>[a(u,{label:"待审核",name:"pending"}),a(u,{label:"已审核",name:"confirmed"}),a(u,{label:"有争议",name:"disputed"})]),_:1},8,["modelValue"]),R((v(),j(J,{data:S.value,stripe:""},{default:t(()=>[a(d,{prop:"id",label:"ID",width:"60"}),a(d,{prop:"event_title",label:"赛事","min-width":"120"}),a(d,{prop:"round_name",label:"轮次",width:"80"}),a(d,{label:"比赛双方","min-width":"200"},{default:t(({row:l})=>[_("span",{class:z({winner:l.winner_id===l.player1_id})},p(l.player1_name),3),e[5]||(e[5]=_("span",{style:{margin:"0 8px"}},"vs",-1)),_("span",{class:z({winner:l.winner_id===l.player2_id})},p(l.player2_name),3)]),_:1}),a(d,{prop:"score",label:"比分",width:"100"}),a(d,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a(I,{type:M[l.status]},{default:t(()=>[r(p(U[l.status]),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"created_at",label:"录入时间",width:"160"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[l.status==="pending"?(v(),x(B,{key:0},[a(c,{size:"small",type:"success",onClick:h=>T(l)},{default:t(()=>[...e[6]||(e[6]=[r("确认",-1)])]),_:1},8,["onClick"]),a(c,{size:"small",type:"warning",onClick:h=>O(l)},{default:t(()=>[...e[7]||(e[7]=[r("标记争议",-1)])]),_:1},8,["onClick"])],64)):l.status==="disputed"?(v(),x(B,{key:1},[a(c,{size:"small",onClick:h=>D(l)},{default:t(()=>[...e[8]||(e[8]=[r("修改比分",-1)])]),_:1},8,["onClick"]),a(c,{size:"small",type:"success",onClick:h=>T(l)},{default:t(()=>[...e[9]||(e[9]=[r("确认",-1)])]),_:1},8,["onClick"])],64)):(v(),j(c,{key:2,size:"small",disabled:""},{default:t(()=>[...e[10]||(e[10]=[r("已审核",-1)])]),_:1}))]),_:1})]),_:1},8,["data"])),[[G,w.value]])]),_:1}),a(A,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),title:"修改比分",width:"400px"},{footer:t(()=>[a(c,{onClick:e[3]||(e[3]=l=>f.value=!1)},{default:t(()=>[...e[11]||(e[11]=[r("取消",-1)])]),_:1}),a(c,{type:"primary",onClick:E,loading:k.value},{default:t(()=>[...e[12]||(e[12]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(L,{model:s.value,"label-width":"80px"},{default:t(()=>[a(V,{label:"比赛"},{default:t(()=>[_("span",null,p(s.value.player1_name)+" vs "+p(s.value.player2_name),1)]),_:1}),a(V,{label:"比分"},{default:t(()=>[a(P,{modelValue:s.value.score,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.score=l),placeholder:"如: 3:2"},null,8,["modelValue"])]),_:1}),a(V,{label:"胜者"},{default:t(()=>[a(q,{modelValue:s.value.winner_id,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.winner_id=l)},{default:t(()=>[a($,{label:s.value.player1_id},{default:t(()=>[r(p(s.value.player1_name),1)]),_:1},8,["label"]),a($,{label:s.value.player2_id},{default:t(()=>[r(p(s.value.player2_name),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ae=H(X,[["__scopeId","data-v-45a055f5"]]);export{ae as default};
