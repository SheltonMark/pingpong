import{f as H}from"./format-DoeqoNZs.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as m,p as Q,c as T,o as v,b as _,d as a,w as t,f as o,E as r,q as R,s as W,l as j,y as B,t as u,h as i,m as X,F as N,G as U}from"./index-BHlLEje6.js";const Y={class:"page"},Z={__name:"Scores",setup(ee){const w=m(!1),x=m([]),C=m("pending"),k=m(!1),f=m(!1),n=m({id:null,player1_id:null,player1_name:"",player2_id:null,player2_name:"",score:"",winner_id:null}),z={pending:"待审核",confirmed:"已确认",disputed:"有争议"},D={pending:"warning",confirmed:"success",disputed:"danger"},b=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,y=async()=>{w.value=!0;try{const e=await(await fetch(`/api/admin/matches?user_id=${b()}&status=${C.value}`)).json();e.success&&(x.value=e.data||[])}catch(s){console.error("加载比赛失败:",s),r.error("加载失败")}finally{w.value=!1}},S=async s=>{try{await U.confirm("确认这场比赛的成绩吗？","提示");const c=await(await fetch(`/api/admin/matches/${s.id}/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:b()})})).json();c.success?(r.success("成绩已确认"),y()):r.error(c.message||"操作失败")}catch(e){e!=="cancel"&&(console.error("确认失败:",e),r.error("操作失败"))}},M=async s=>{try{const{value:e}=await U.prompt("请输入争议原因","标记争议",{confirmButtonText:"确定",cancelButtonText:"取消"}),g=await(await fetch(`/api/admin/matches/${s.id}/dispute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:e,user_id:b()})})).json();g.success?(r.success("已标记争议"),y()):r.error(g.message||"操作失败")}catch(e){e!=="cancel"&&console.error("标记失败:",e)}},O=s=>{n.value={id:s.id,player1_id:s.player1_id,player1_name:s.player1_name,player2_id:s.player2_id,player2_name:s.player2_name,score:s.score,winner_id:s.winner_id},f.value=!0},E=async()=>{if(!n.value.score||!n.value.winner_id){r.warning("请填写完整信息");return}k.value=!0;try{const e=await(await fetch(`/api/admin/matches/${n.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:n.value.score,winner_id:n.value.winner_id,user_id:b()})})).json();e.success?(r.success("比分已更新"),f.value=!1,y()):r.error(e.message||"更新失败")}catch(s){console.error("更新失败:",s),r.error("更新失败")}finally{k.value=!1}};return Q(()=>{y()}),(s,e)=>{const c=o("el-tab-pane"),g=o("el-tabs"),d=o("el-table-column"),I=o("el-tag"),p=o("el-button"),J=o("el-table"),F=o("el-card"),V=o("el-form-item"),P=o("el-input"),$=o("el-radio"),q=o("el-radio-group"),G=o("el-form"),L=o("el-dialog"),A=R("loading");return v(),T("div",Y,[e[13]||(e[13]=_("div",{class:"page-header"},[_("h2",null,"成绩审核")],-1)),a(F,null,{default:t(()=>[a(g,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),onTabChange:y},{default:t(()=>[a(c,{label:"待审核",name:"pending"}),a(c,{label:"已审核",name:"confirmed"}),a(c,{label:"有争议",name:"disputed"})]),_:1},8,["modelValue"]),W((v(),j(J,{data:x.value,stripe:""},{default:t(()=>[a(d,{prop:"id",label:"ID",width:"60"}),a(d,{prop:"event_title",label:"赛事","min-width":"120"}),a(d,{prop:"round_name",label:"轮次",width:"80"}),a(d,{label:"比赛双方","min-width":"200"},{default:t(({row:l})=>[_("span",{class:B({winner:l.winner_id===l.player1_id})},u(l.player1_name),3),e[5]||(e[5]=_("span",{style:{margin:"0 8px"}},"vs",-1)),_("span",{class:B({winner:l.winner_id===l.player2_id})},u(l.player2_name),3)]),_:1}),a(d,{prop:"score",label:"比分",width:"100"}),a(d,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a(I,{type:D[l.status]},{default:t(()=>[i(u(z[l.status]),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"录入时间",width:"160"},{default:t(({row:l})=>[i(u(X(H)(l.created_at)),1)]),_:1}),a(d,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[l.status==="pending"?(v(),T(N,{key:0},[a(p,{size:"small",type:"success",onClick:h=>S(l)},{default:t(()=>[...e[6]||(e[6]=[i("确认",-1)])]),_:1},8,["onClick"]),a(p,{size:"small",type:"warning",onClick:h=>M(l)},{default:t(()=>[...e[7]||(e[7]=[i("标记争议",-1)])]),_:1},8,["onClick"])],64)):l.status==="disputed"?(v(),T(N,{key:1},[a(p,{size:"small",onClick:h=>O(l)},{default:t(()=>[...e[8]||(e[8]=[i("修改比分",-1)])]),_:1},8,["onClick"]),a(p,{size:"small",type:"success",onClick:h=>S(l)},{default:t(()=>[...e[9]||(e[9]=[i("确认",-1)])]),_:1},8,["onClick"])],64)):(v(),j(p,{key:2,size:"small",disabled:""},{default:t(()=>[...e[10]||(e[10]=[i("已审核",-1)])]),_:1}))]),_:1})]),_:1},8,["data"])),[[A,w.value]])]),_:1}),a(L,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),title:"修改比分",width:"400px"},{footer:t(()=>[a(p,{onClick:e[3]||(e[3]=l=>f.value=!1)},{default:t(()=>[...e[11]||(e[11]=[i("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:E,loading:k.value},{default:t(()=>[...e[12]||(e[12]=[i("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(G,{model:n.value,"label-width":"80px"},{default:t(()=>[a(V,{label:"比赛"},{default:t(()=>[_("span",null,u(n.value.player1_name)+" vs "+u(n.value.player2_name),1)]),_:1}),a(V,{label:"比分"},{default:t(()=>[a(P,{modelValue:n.value.score,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.score=l),placeholder:"如: 3:2"},null,8,["modelValue"])]),_:1}),a(V,{label:"胜者"},{default:t(()=>[a(q,{modelValue:n.value.winner_id,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.winner_id=l)},{default:t(()=>[a($,{label:n.value.player1_id},{default:t(()=>[i(u(n.value.player1_name),1)]),_:1},8,["label"]),a($,{label:n.value.player2_id},{default:t(()=>[i(u(n.value.player2_name),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},se=K(Z,[["__scopeId","data-v-b56f2da8"]]);export{se as default};
