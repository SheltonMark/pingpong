import{f as B}from"./format-DoeqoNZs.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,p as W,c as m,o as r,b as c,d as a,k as w,w as s,f as l,q as X,F as I,v as M,l as k,s as Y,t as n,h as d,m as U,E as f,G as Z}from"./index-CzSjYIjn.js";const ee={class:"page"},te={class:"page-header"},ae={class:"header-actions"},se={style:{display:"flex","align-items":"center",gap:"8px"}},le={style:{"font-size":"12px",color:"#999"}},ne={key:0,class:"members-list"},oe={key:0},ie={key:1,style:{color:"#999"}},re={style:{"margin-top":"20px","text-align":"right"}},ce={key:0,class:"empty-state"},de={key:0,class:"team-detail"},ue={class:"detail-section"},pe={class:"detail-section"},_e={__name:"TeamManagement",setup(me){const x=_(!1),T=_([]),D=_([]),g=_(null),C=_(1),V=_(0),$=_(!1),p=_(null),E={pending:"组队中",confirmed:"已确认",cancelled:"已解散"},S={pending:"warning",confirmed:"success",cancelled:"danger"},b=()=>JSON.parse(localStorage.getItem("adminUser")||"{}").id,O=async()=>{try{const t=await(await fetch(`/api/admin/events?user_id=${b()}`)).json();t.success&&(D.value=(t.data||[]).filter(u=>u.event_type==="team"))}catch(o){console.error("加载团体赛事失败:",o)}},z=async()=>{if(!g.value){T.value=[],V.value=0;return}x.value=!0;try{const t=await(await fetch(`/api/admin/teams?user_id=${b()}&event_id=${g.value}&page=${C.value}`)).json();t.success&&(T.value=t.data||[],V.value=t.total||0)}catch(o){console.error("加载队伍列表失败:",o),f.error("加载失败")}finally{x.value=!1}},F=async o=>{try{const u=await(await fetch(`/api/admin/teams/${o.id}?user_id=${b()}`)).json();u.success?(p.value=u.data,$.value=!0):f.error(u.message||"获取详情失败")}catch(t){console.error("获取队伍详情失败:",t),f.error("获取详情失败")}},J=async o=>{try{await Z.confirm(`确认解散队伍"${o.team_name}"吗？队伍中所有成员的报名都将被取消。`,"警告",{type:"warning"});const u=await(await fetch(`/api/admin/teams/${o.id}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:b()})})).json();u.success?(f.success("队伍已解散"),z()):f.error(u.message||"操作失败")}catch(t){t!=="cancel"&&(console.error("解散队伍失败:",t),f.error("操作失败"))}};return W(()=>{O()}),(o,t)=>{const u=l("el-option"),L=l("el-select"),i=l("el-table-column"),P=l("el-avatar"),h=l("el-tag"),N=l("el-button"),j=l("el-table"),q=l("el-pagination"),G=l("el-card"),A=l("el-empty"),y=l("el-descriptions-item"),H=l("el-descriptions"),K=l("el-dialog"),Q=X("loading");return r(),m("div",ee,[c("div",te,[t[3]||(t[3]=c("h2",null,"团体赛队伍管理",-1)),c("div",ae,[a(L,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),placeholder:"选择赛事",clearable:"",onChange:z},{default:s(()=>[(r(!0),m(I,null,M(D.value,e=>(r(),k(u,{key:e.id,label:e.title,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(G,null,{default:s(()=>[Y((r(),k(j,{data:T.value,stripe:""},{default:s(()=>[a(i,{prop:"id",label:"ID",width:"60"}),a(i,{prop:"team_name",label:"队伍名称","min-width":"120"}),a(i,{label:"领队","min-width":"150"},{default:s(({row:e})=>[c("div",se,[a(P,{size:32,src:e.captain_avatar},null,8,["src"]),c("div",null,[c("div",null,n(e.captain_name),1),c("div",le,n(e.captain_phone),1)])])]),_:1}),a(i,{label:"队员","min-width":"200"},{default:s(({row:e})=>[e.members&&e.members.length>0?(r(),m("div",ne,[(r(!0),m(I,null,M(e.members,v=>(r(),k(h,{key:v.id,size:"small",type:v.status==="confirmed"?"success":"warning",style:{margin:"2px"}},{default:s(()=>[d(n(v.name)+" ",1),v.status!=="confirmed"?(r(),m("span",oe,"(待确认)")):w("",!0)]),_:2},1032,["type"]))),128))])):(r(),m("span",ie,"暂无队员"))]),_:1}),a(i,{prop:"member_count",label:"人数",width:"80"},{default:s(({row:e})=>[d(n(e.confirmed_count||0)+"/"+n(e.total_slots||5),1)]),_:1}),a(i,{prop:"status",label:"状态",width:"100"},{default:s(({row:e})=>[a(h,{type:S[e.status]},{default:s(()=>[d(n(E[e.status]),1)]),_:2},1032,["type"])]),_:1}),a(i,{label:"创建时间",width:"160"},{default:s(({row:e})=>[d(n(U(B)(e.created_at)),1)]),_:1}),a(i,{label:"操作",width:"150",fixed:"right"},{default:s(({row:e})=>[a(N,{size:"small",onClick:v=>F(e)},{default:s(()=>[...t[4]||(t[4]=[d("详情",-1)])]),_:1},8,["onClick"]),e.status!=="cancelled"?(r(),k(N,{key:0,size:"small",type:"danger",onClick:v=>J(e)},{default:s(()=>[...t[5]||(t[5]=[d("解散",-1)])]),_:1},8,["onClick"])):w("",!0)]),_:1})]),_:1},8,["data"])),[[Q,x.value]]),c("div",re,[a(q,{"current-page":C.value,"onUpdate:currentPage":t[1]||(t[1]=e=>C.value=e),"page-size":20,total:V.value,layout:"total, prev, pager, next",onCurrentChange:z},null,8,["current-page","total"])])]),_:1}),g.value?w("",!0):(r(),m("div",ce,[a(A,{description:"请选择一个团体赛事查看队伍情况"})])),a(K,{modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=e=>$.value=e),title:"队伍详情",width:"600px"},{default:s(()=>[p.value?(r(),m("div",de,[c("div",ue,[t[6]||(t[6]=c("h4",null,"基本信息",-1)),a(H,{column:2,border:""},{default:s(()=>[a(y,{label:"队伍名称"},{default:s(()=>[d(n(p.value.team_name),1)]),_:1}),a(y,{label:"状态"},{default:s(()=>[a(h,{type:S[p.value.status]},{default:s(()=>[d(n(E[p.value.status]),1)]),_:1},8,["type"])]),_:1}),a(y,{label:"领队"},{default:s(()=>[d(n(p.value.captain_name),1)]),_:1}),a(y,{label:"联系电话"},{default:s(()=>[d(n(p.value.captain_phone),1)]),_:1}),a(y,{label:"创建时间",span:2},{default:s(()=>[d(n(U(B)(p.value.created_at)),1)]),_:1})]),_:1})]),c("div",pe,[t[7]||(t[7]=c("h4",null,"队员列表",-1)),a(j,{data:p.value.members||[],stripe:"",size:"small"},{default:s(()=>[a(i,{prop:"name",label:"姓名"}),a(i,{prop:"phone",label:"电话"}),a(i,{prop:"position",label:"位置"}),a(i,{prop:"status",label:"状态"},{default:s(({row:e})=>[a(h,{type:e.status==="confirmed"?"success":"warning",size:"small"},{default:s(()=>[d(n(e.status==="confirmed"?"已确认":"待确认"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])])):w("",!0)]),_:1},8,["modelValue"])])}}},ye=R(_e,[["__scopeId","data-v-bedb7fac"]]);export{ye as default};
