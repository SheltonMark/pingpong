<view class="admin-users-page">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <input
      class="search-input"
      placeholder="搜索用户名或手机号"
      value="{{keyword}}"
      bindinput="onSearchInput"
      bindconfirm="onSearch"
    />
    <button class="search-btn" bindtap="onSearch">搜索</button>
  </view>

  <!-- 用户列表 -->
  <view class="user-list">
    <view
      class="user-item"
      wx:for="{{users}}"
      wx:key="id"
    >
      <view class="user-main" bindtap="onViewProfile" data-id="{{item.id}}">
        <view class="user-info">
          <text class="user-name">{{item.name || '未命名'}}</text>
          <text class="user-type">{{item.type_label}}</text>
        </view>
        <view class="user-meta">
          <text class="meta-item">{{item.school_name || '未设置学校'}}</text>
          <text class="meta-item">积分：{{item.points || 0}}</text>
          <text class="meta-item">{{item.wins || 0}}胜 {{item.losses || 0}}负</text>
        </view>
        <view class="user-roles" wx:if="{{item.roles_list.length > 0}}">
          <text class="role-tag" wx:for="{{item.roles_list}}" wx:for-item="role" wx:key="*this">{{role}}</text>
        </view>
      </view>
      <view class="user-actions">
        <button class="assign-btn" bindtap="onShowRolePicker" data-user="{{item}}">分配角色</button>
      </view>
    </view>
  </view>

  <view class="loading" wx:if="{{isLoading}}">加载中...</view>
  <view class="empty" wx:if="{{!isLoading && users.length === 0}}">暂无用户</view>
  <view class="load-more" wx:if="{{!isLoading && hasMore}}" bindtap="onReachBottom">加载更多</view>
</view>

<!-- 角色分配弹窗 -->
<role-picker
  show="{{showRolePicker}}"
  user="{{selectedUser}}"
  roles="{{availableRoles}}"
  bindclose="onCloseRolePicker"
  bindassign="onAssignRole"
/>
