<view class="check-in-page">
  <!-- åœ°å›¾æ˜¾ç¤º -->
  <view class="map-section" wx:if="{{location && nearestPoint}}">
    <map
      id="checkInMap"
      class="check-in-map"
      latitude="{{nearestPoint.latitude}}"
      longitude="{{nearestPoint.longitude}}"
      scale="{{mapScale}}"
      markers="{{markers}}"
      circles="{{circles}}"
      show-location
      bindmarkertap="onMarkerTap"
    ></map>
    <view class="map-btn-group">
      <view class="map-btn" bindtap="moveToLocation">
        <text>ğŸ“ æˆ‘çš„ä½ç½®</text>
      </view>
    </view>
  </view>

  <!-- ç­¾åˆ°çŠ¶æ€å¡ç‰‡ -->
  <view class="status-card">
    <view class="status-icon {{canCheckIn ? 'active' : ''}}">ğŸ“</view>

    <block wx:if="{{isLoading}}">
      <text class="status-title">å®šä½ä¸­...</text>
      <text class="status-desc">æ­£åœ¨è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯</text>
    </block>
    <block wx:elif="{{nearestPoint}}">
      <text class="status-title">{{nearestPoint.name}}</text>
      <text class="status-desc">å½“å‰ä½ç½®è·ç¦»ç­¾åˆ°ç‚¹ {{distance}}m</text>
      <text class="status-hint" wx:if="{{!canCheckIn}}">éœ€è¦åœ¨{{nearestPoint.radius}}mèŒƒå›´å†…æ‰èƒ½ç­¾åˆ°</text>

      <button
        class="check-in-btn {{canCheckIn ? 'active' : 'disabled'}}"
        bindtap="onCheckIn"
        disabled="{{!canCheckIn || isCheckingIn}}"
      >
        {{isCheckingIn ? 'ç­¾åˆ°ä¸­...' : (canCheckIn ? 'ç«‹å³ç­¾åˆ°' : 'è·ç¦»è¿‡è¿œ')}}
      </button>
    </block>
    <block wx:else>
      <text class="status-title">æœªæ‰¾åˆ°ç­¾åˆ°ç‚¹</text>
      <text class="status-desc">é™„è¿‘æ²¡æœ‰å¯ç”¨çš„ç­¾åˆ°ç‚¹</text>
    </block>

    <view class="refresh-btn" bindtap="onRefreshLocation">
      <text>ğŸ”„ åˆ·æ–°ä½ç½®</text>
    </view>
  </view>

  <!-- ç­¾åˆ°è®°å½• -->
  <view class="records-card">
    <view class="card-header">
      <text class="card-title">æœ¬æœˆç­¾åˆ°è®°å½•</text>
      <text class="card-count">{{monthlyCount}}æ¬¡</text>
    </view>

    <view class="record-list">
      <view class="record-item" wx:for="{{records}}" wx:key="id">
        <view class="record-info">
          <text class="record-date">{{item.date_label}}</text>
          <text class="record-point">{{item.point_name}}</text>
        </view>
        <text class="record-time">{{item.time_label}} å·²ç­¾åˆ°</text>
      </view>

      <view class="empty" wx:if="{{records.length === 0}}">
        <text>æš‚æ— ç­¾åˆ°è®°å½•</text>
      </view>
    </view>
  </view>
</view>
