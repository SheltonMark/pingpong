<!-- pages/event-detail/event-detail.wxml -->
<view class="event-detail-page" wx:if="{{!loading}}">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="event-header">
    <view class="header-bg"></view>
    <view class="header-content">
      <view class="event-type-tag {{event.event_type}}">
        {{event.event_type === 'singles' ? 'å•æ‰“' : event.event_type === 'doubles' ? 'åŒæ‰“' : 'å›¢ä½“'}}
      </view>
      <view class="event-title">{{event.title}}</view>
      <view class="event-status-tag {{event.status}}">
        {{event.status === 'registration' ? 'æŠ¥åä¸­' : event.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'info' ? 'active' : ''}}" data-tab="info" bindtap="onTabChange">èµ›äº‹ä¿¡æ¯</view>
    <view class="tab-item {{currentTab === 'players' ? 'active' : ''}}" data-tab="players" bindtap="onTabChange">å‚èµ›é€‰æ‰‹ ({{registrations.length}})</view>
    <view class="tab-item {{currentTab === 'matches' ? 'active' : ''}}" data-tab="matches" bindtap="onTabChange">å¯¹é˜µè¡¨</view>
  </view>

  <!-- èµ›äº‹ä¿¡æ¯ -->
  <view class="tab-content" wx:if="{{currentTab === 'info'}}">
    <view class="info-card">
      <view class="info-row">
        <text class="info-label">ğŸ“… æ¯”èµ›æ—¶é—´</text>
        <text class="info-value">{{event.event_start_display || event.event_start}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">ğŸ“ æ¯”èµ›åœ°ç‚¹</text>
        <text class="info-value">{{event.location}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">ğŸ† èµ›åˆ¶</text>
        <text class="info-value">{{event.event_format === 'knockout' ? 'æ·˜æ±°èµ›' : event.event_format === 'round_robin' ? 'å¾ªç¯èµ›' : 'å°ç»„+æ·˜æ±°'}} Â· {{event.best_of}}å±€{{event.games_to_win || (event.best_of == 3 ? '2' : event.best_of == 5 ? '3' : '4')}}èƒœ</text>
      </view>
      <view class="info-row">
        <text class="info-label">ğŸ“Š è®¡å…¥ç§¯åˆ†</text>
        <text class="info-value">{{event.counts_for_ranking ? 'æ˜¯' : 'å¦'}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">ğŸ‘¤ æŠ¥åäººæ•°</text>
        <text class="info-value">{{registrations.length}}/{{event.max_participants}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">â° æŠ¥åæˆªæ­¢</text>
        <text class="info-value">{{event.registration_end_display || event.registration_end}}</text>
      </view>
    </view>

    <view class="desc-card" wx:if="{{event.description}}">
      <view class="card-title">èµ›äº‹è¯´æ˜</view>
      <rich-text class="desc-content" nodes="{{event.description}}"></rich-text>
    </view>

    <!-- å›¢ä½“èµ›é¢†é˜Ÿç”³è¯· -->
    <view class="captain-card" wx:if="{{event.event_type === 'team'}}">
      <view class="card-title">é¢†é˜Ÿç”³è¯·</view>
      <view class="captain-content">
        <view wx:if="{{isCaptain}}" class="captain-status approved">
          <text class="status-icon">âœ“</text>
          <text>æ‚¨æ˜¯è¯¥èµ›äº‹çš„é¢†é˜Ÿ</text>
        </view>
        <view wx:elif="{{captainStatus === 'pending'}}" class="captain-status pending">
          <text class="status-icon">â³</text>
          <text>é¢†é˜Ÿç”³è¯·å®¡æ‰¹ä¸­</text>
        </view>
        <view wx:elif="{{captainStatus === 'rejected'}}" class="captain-status rejected">
          <text class="status-icon">âœ—</text>
          <text>ç”³è¯·è¢«æ‹’ç»ï¼Œå¯é‡æ–°ç”³è¯·</text>
          <button class="apply-btn small" bindtap="onApplyCaptain">é‡æ–°ç”³è¯·</button>
        </view>
        <view wx:else class="captain-tip">
          <text>é¢†é˜Ÿå¯ä»¥ç»„å»ºé˜Ÿä¼å¹¶ç®¡ç†é˜Ÿå‘˜æŠ¥å</text>
          <button class="apply-btn" bindtap="onApplyCaptain">ç”³è¯·æˆä¸ºé¢†é˜Ÿ</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å‚èµ›é€‰æ‰‹ -->
  <view class="tab-content" wx:if="{{currentTab === 'players'}}">
    <view class="player-list" wx:if="{{registrations.length > 0}}">
      <view class="player-item" wx:for="{{registrations}}" wx:key="id">
        <view class="player-rank">{{index + 1}}</view>
        <image class="player-avatar" src="{{item.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill" />
        <view class="player-info">
          <text class="player-name">{{item.name}}</text>
          <text class="player-college">{{item.college_name}}</text>
        </view>
      </view>
    </view>
    <view class="empty-tip" wx:else>æš‚æ— æŠ¥å</view>
  </view>

  <!-- å¯¹é˜µè¡¨ -->
  <view class="tab-content" wx:if="{{currentTab === 'matches'}}">
    <view class="match-list" wx:if="{{matches.length > 0}}">
      <view class="match-item" wx:for="{{matches}}" wx:key="id">
        <view class="match-round">ç¬¬{{item.round}}è½® Â· ç¬¬{{item.match_order}}åœº</view>
        <view class="match-players">
          <view class="player-side">
            <text class="player">{{item.player1_name || 'å¾…å®š'}}</text>
            <text class="score" wx:if="{{item.status === 'finished'}}">{{item.player1_games}}</text>
          </view>
          <text class="vs">VS</text>
          <view class="player-side">
            <text class="score" wx:if="{{item.status === 'finished'}}">{{item.player2_games}}</text>
            <text class="player">{{item.player2_name || 'å¾…å®š'}}</text>
          </view>
        </view>
        <view class="match-status {{item.status}}">
          {{item.status === 'finished' ? 'å·²ç»“æŸ' : item.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å¾…è¿›è¡Œ'}}
        </view>
      </view>
    </view>
    <view class="empty-tip" wx:else>å¯¹é˜µè¡¨å°šæœªç”Ÿæˆ</view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="bottom-action" wx:if="{{event.status === 'registration'}}">
    <button class="register-btn" wx:if="{{!isRegistered}}" bindtap="onRegister">ç«‹å³æŠ¥å</button>
    <button class="cancel-btn" wx:else bindtap="onCancelRegister">å–æ¶ˆæŠ¥å</button>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>
