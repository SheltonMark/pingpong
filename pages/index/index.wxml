<view class="home-page">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header-section">
    <view class="header-bg"></view>
    <view class="header-content">
      <!-- å­¦æ ¡é€‰æ‹©å™¨ -->
      <picker mode="selector" range="{{schoolPickerList}}" value="{{schoolPickerIndex}}" bindchange="onSchoolPickerChange">
        <view class="school-selector">
          <text class="school-name">{{currentSchoolName || userInfo.school_name || 'é€‰æ‹©å­¦æ ¡'}}</text>
          <text class="selector-arrow">â–¼</text>
        </view>
      </picker>

      <!-- é—®å€™è¯­ -->
      <view class="greeting-section">
        <text class="greeting-time">{{greeting}}</text>
        <block wx:if="{{isLoggedIn}}">
          <text class="greeting-name">{{userInfo.name || 'çƒå‹'}}</text>
        </block>
        <block wx:else>
          <text class="greeting-name login-link" bindtap="onTapLogin">ç‚¹å‡»ç™»å½•</text>
        </block>
      </view>
    </view>
  </view>

    <!-- å…¬å‘Šè½®æ’­å›¾ -->
    <view class="announcement-swiper-wrapper" wx:if="{{announcements.length > 0}}">
      <swiper
        class="announcement-swiper"
        indicator-dots="{{false}}"
        autoplay="{{true}}"
        interval="{{4000}}"
        duration="{{500}}"
        circular="{{true}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{announcements}}" wx:key="id">
          <view class="announcement-card" data-item="{{item}}" bindtap="onTapAnnouncement">
            <view class="announcement-tag">
              <text class="tag-icon">ğŸ“¢</text>
              <text class="tag-text">{{item.link_type === 'event' ? 'èµ›äº‹' : 'å…¬å‘Š'}}</text>
            </view>
            <view class="announcement-content">
              <text class="announcement-title">{{item.title}}</text>
              <text class="announcement-desc">{{item.content}}</text>
            </view>
            <text class="announcement-arrow">â€º</text>
          </view>
        </swiper-item>
      </swiper>
      <!-- æŒ‡ç¤ºå™¨ -->
      <view class="swiper-dots" wx:if="{{announcements.length > 1}}">
        <view
          class="dot {{currentSwiperIndex === index ? 'active' : ''}}"
          wx:for="{{announcements}}"
          wx:key="id"
        ></view>
      </view>
    </view>

    <!-- å¿«æ·å…¥å£ -->
    <view class="quick-section">
      <view class="quick-grid">
        <view
          wx:for="{{quickActions}}"
          wx:key="label"
          class="quick-item"
          data-url="{{item.url}}"
          bindtap="onTapAction"
        >
          <view class="quick-icon-wrapper {{item.bgColor}}">
            <image class="quick-icon-img" src="{{item.iconUrl}}" mode="aspectFit" wx:if="{{item.iconUrl}}" />
            <text class="quick-icon-text" wx:else>{{item.icon}}</text>
          </view>
          <text class="quick-label">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- ç§¯åˆ†æ’è¡Œ -->
    <view class="ranking-section">
      <view class="section-header">
        <text class="section-title">ç§¯åˆ†æ’è¡Œ</text>
        <text class="section-more" bindtap="onTapRankingMore">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      <view class="ranking-list">
        <view
          wx:for="{{rankingList}}"
          wx:key="user_id"
          class="ranking-item"
          data-id="{{item.user_id}}"
          bindtap="onTapRankingUser"
        >
          <view class="rank-badge rank-{{index + 1}}">
            <text class="rank-num">{{index + 1}}</text>
          </view>
          <image class="rank-avatar" src="{{item.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill" />
          <view class="rank-info">
            <text class="rank-name">{{item.name}}</text>
            <text class="rank-college">{{item.college_name}} Â· {{item.user_type_label}}</text>
          </view>
          <view class="rank-score">
            <text class="score-value">{{item.score}}</text>
            <text class="score-label">ç§¯åˆ†</text>
          </view>
        </view>
      </view>
    </view>

  <!-- éšç§æ”¿ç­–å¼¹çª— -->
  <privacy-modal
    show="{{showPrivacyModal}}"
    bind:agree="onAgreePrivacy"
    bind:disagree="onDisagreePrivacy"
  />
</view>
