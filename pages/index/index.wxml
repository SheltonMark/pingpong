<view class="home-page">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <block wx:if="{{!isLoggedIn}}">
    <view class="welcome-section full-height">
      <view class="welcome-bg"></view>
      <view class="welcome-content">
        <text class="welcome-icon">ğŸ“</text>
        <text class="welcome-title">æ ¡ä¹’ç½‘</text>
        <text class="welcome-subtitle">æ ¡å›­ä¹’ä¹“çƒçˆ±å¥½è€…ç¤¾åŒº</text>
        <text class="welcome-desc">çº¦çƒã€èµ›äº‹ã€æ’è¡Œã€ç­¾åˆ°ï¼Œä¸€ç«™æå®š</text>
        <button class="login-btn" bindtap="onTapLogin">å¾®ä¿¡ç™»å½•</button>
      </view>
    </view>
  </block>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <block wx:else>
    <!-- å¤´éƒ¨åŒºåŸŸ -->
    <view class="header-section">
      <view class="header-bg"></view>
      <view class="header-content">
        <!-- å­¦æ ¡é€‰æ‹©å™¨ -->
        <view class="school-selector" bindtap="onTapSchoolSelector">
          <text class="school-name">{{userInfo.school_name || 'é€‰æ‹©å­¦æ ¡'}}</text>
          <text class="selector-arrow">â–¼</text>
        </view>

        <!-- é—®å€™è¯­ -->
        <view class="greeting-section">
          <text class="greeting-time">{{greeting}}</text>
          <text class="greeting-name">{{userInfo.name || 'çƒå‹'}}</text>
        </view>
      </view>
    </view>

    <!-- å…¬å‘Šå¡ç‰‡ -->
    <view class="announcement-card" wx:if="{{announcement}}" bindtap="onTapAnnouncement">
      <view class="announcement-tag">
        <text class="tag-icon">ğŸ“¢</text>
        <text class="tag-text">å…¬å‘Š</text>
      </view>
      <view class="announcement-content">
        <text class="announcement-title">{{announcement.title}}</text>
        <text class="announcement-desc">{{announcement.desc}}</text>
      </view>
      <text class="announcement-emoji">ğŸ“‹</text>
    </view>

    <!-- å¿«æ·å…¥å£ -->
    <view class="quick-section">
      <view class="quick-grid">
        <view
          wx:for="{{quickActions}}"
          wx:key="label"
          class="quick-item"
          data-url="{{item.url}}"
          bindtap="onTapAction"
        >
          <view class="quick-icon-wrapper {{item.bgColor}}">
            <image class="quick-icon-img" src="{{item.iconUrl}}" mode="aspectFit" wx:if="{{item.iconUrl}}" />
            <text class="quick-icon-text" wx:else>{{item.icon}}</text>
          </view>
          <text class="quick-label">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- ç§¯åˆ†æ’è¡Œ -->
    <view class="ranking-section">
      <view class="section-header">
        <text class="section-title">ç§¯åˆ†æ’è¡Œ</text>
        <text class="section-more" bindtap="onTapRankingMore">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      <view class="ranking-list">
        <view
          wx:for="{{rankingList}}"
          wx:key="user_id"
          class="ranking-item"
          data-id="{{item.user_id}}"
          bindtap="onTapRankingUser"
        >
          <view class="rank-badge rank-{{index + 1}}">
            <text class="rank-num">{{index + 1}}</text>
          </view>
          <image class="rank-avatar" src="{{item.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill" />
          <view class="rank-info">
            <text class="rank-name">{{item.name}}</text>
            <text class="rank-college">{{item.college_name}} Â· {{item.user_type_label}}</text>
          </view>
          <view class="rank-score">
            <text class="score-value">{{item.score}}</text>
            <text class="score-label">ç§¯åˆ†</text>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- éšç§æ”¿ç­–å¼¹çª— -->
  <privacy-modal
    show="{{showPrivacyModal}}"
    bind:agree="onAgreePrivacy"
    bind:disagree="onDisagreePrivacy"
  />
</view>
