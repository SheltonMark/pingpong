<view class="detail-page">
  <view class="invitation-card" wx:if="{{invitation}}">
    <view class="inv-header">
      <image class="creator-avatar" src="{{invitation.creator_avatar || '/images/default-avatar.png'}}" />
      <view class="creator-info">
        <text class="creator-name">{{invitation.creator_name}}</text>
        <text class="inv-school">{{invitation.school_name}}</text>
      </view>
      <view class="inv-status status-{{invitation.status}}">
        {{statusLabels[invitation.status]}}
      </view>
    </view>

    <view class="inv-body">
      <text class="inv-title">{{invitation.title || 'çº¦çƒ'}}</text>
      <text class="inv-content" wx:if="{{invitation.post_content}}">{{invitation.post_content}}</text>

      <view class="inv-meta">
        <view class="meta-item" wx:if="{{invitation.location}}">
          <text class="meta-icon">ğŸ“</text>
          <text>{{invitation.location}}</text>
        </view>
        <view class="meta-item" wx:if="{{invitation.scheduled_time}}">
          <text class="meta-icon">ğŸ•</text>
          <text>{{invitation.time_label}}</text>
        </view>
      </view>
    </view>

    <view class="participants-section">
      <view class="section-title">å‚ä¸è€… ({{invitation.participants.length}}/{{invitation.max_participants}})</view>
      <view class="participant-list">
        <view class="participant-item" wx:for="{{invitation.participants}}" wx:key="id">
          <image class="participant-avatar" src="{{item.avatar_url || '/images/default-avatar.png'}}" />
          <text class="participant-name">{{item.name}}</text>
          <text class="participant-tag" wx:if="{{item.user_id === invitation.creator_id}}">å‘èµ·äºº</text>
        </view>
      </view>
    </view>
  </view>

  <view class="match-section" wx:if="{{match}}">
    <view class="section-title">æ¯”èµ›æ¯”åˆ†</view>
    <view class="match-card">
      <view class="players">
        <view class="player">
          <image src="{{match.player1_avatar || '/images/default-avatar.png'}}" />
          <text>{{match.player1_name}}</text>
        </view>
        <view class="vs">VS</view>
        <view class="player">
          <image src="{{match.player2_avatar || '/images/default-avatar.png'}}" />
          <text>{{match.player2_name}}</text>
        </view>
      </view>
      <view class="scores" wx:if="{{match.scores.length > 0}}">
        <view class="score-row" wx:for="{{match.scores}}" wx:key="game_number">
          <text class="score {{item.player1_score > item.player2_score ? 'winner' : ''}}">{{item.player1_score}}</text>
          <text class="score-sep">ç¬¬{{item.game_number}}å±€</text>
          <text class="score {{item.player2_score > item.player1_score ? 'winner' : ''}}">{{item.player2_score}}</text>
        </view>
      </view>
      <view class="total-score">
        <text class="total {{match.player1_games > match.player2_games ? 'winner' : ''}}">{{match.player1_games || 0}}</text>
        <text class="total-sep">æ€»æ¯”åˆ†</text>
        <text class="total {{match.player2_games > match.player1_games ? 'winner' : ''}}">{{match.player2_games || 0}}</text>
      </view>
      <!-- æ¯”åˆ†ç¡®è®¤çŠ¶æ€ -->
      <view class="confirm-status" wx:if="{{match.status === 'pending_confirm'}}">
        <text class="status-tip">ç­‰å¾…åŒæ–¹ç¡®è®¤æ¯”åˆ†</text>
        <view class="confirm-checks">
          <text class="{{match.player1_confirmed ? 'confirmed' : ''}}">{{match.player1_name}}: {{match.player1_confirmed ? 'å·²ç¡®è®¤' : 'å¾…ç¡®è®¤'}}</text>
          <text class="{{match.player2_confirmed ? 'confirmed' : ''}}">{{match.player2_name}}: {{match.player2_confirmed ? 'å·²ç¡®è®¤' : 'å¾…ç¡®è®¤'}}</text>
        </view>
      </view>
      <view class="match-finished" wx:if="{{match.status === 'finished'}}">
        <text class="finished-tip">æ¯”èµ›å·²ç»“æŸ</text>
      </view>
    </view>
  </view>

  <view class="action-bar">
    <!-- æ‹›å‹Ÿä¸­ï¼šå‚ä¸/é€€å‡º -->
    <block wx:if="{{invitation.status === 'open'}}">
      <button wx:if="{{!hasJoined}}" class="action-btn primary" bindtap="onJoin">å‚ä¸çº¦çƒ</button>
      <button wx:elif="{{!isCreator}}" class="action-btn secondary" bindtap="onLeave">é€€å‡ºçº¦çƒ</button>
    </block>

    <!-- åˆ›å»ºè€…å¯ä»¥å¼€å§‹æ¯”èµ› -->
    <block wx:if="{{isCreator && (invitation.status === 'full' || (invitation.status === 'open' && invitation.participants.length >= 2))}}">
      <button class="action-btn primary" bindtap="onStartMatch">å¼€å§‹æ¯”èµ›</button>
    </block>

    <!-- è¿›è¡Œä¸­ï¼šå½•å…¥æ¯”åˆ† -->
    <block wx:if="{{isPlayer && invitation.status === 'ongoing' && (!match || !match.scores || match.scores.length === 0)}}">
      <button class="action-btn primary" bindtap="onEnterScore">å½•å…¥æ¯”åˆ†</button>
    </block>

    <!-- å¾…ç¡®è®¤ï¼šç¡®è®¤æ¯”åˆ† -->
    <block wx:if="{{isPlayer && match && match.status === 'pending_confirm'}}">
      <button class="action-btn primary" wx:if="{{!hasConfirmed}}" bindtap="onConfirmScore">ç¡®è®¤æ¯”åˆ†</button>
      <button class="action-btn secondary" wx:if="{{!hasConfirmed}}" bindtap="onEnterScore">ä¿®æ”¹æ¯”åˆ†</button>
      <text class="confirmed-text" wx:if="{{hasConfirmed}}">æ‚¨å·²ç¡®è®¤ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤</text>
    </block>

    <!-- åˆ›å»ºè€…å¯ä»¥ç»“æŸæ¯”èµ› -->
    <block wx:if="{{isCreator && invitation.status === 'ongoing' && match && match.status === 'finished'}}">
      <button class="action-btn primary" bindtap="onFinishMatch">ç»“æŸçº¦çƒ</button>
    </block>
  </view>
</view>
