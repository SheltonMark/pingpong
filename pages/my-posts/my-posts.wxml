<view class="my-posts-page">
  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view
      class="filter-tab {{currentType === '' ? 'active' : ''}}"
      bindtap="onSelectType"
      data-type=""
    >å…¨éƒ¨</view>
    <view
      class="filter-tab {{currentType === 'post' ? 'active' : ''}}"
      bindtap="onSelectType"
      data-type="post"
    >å¸–å­</view>
    <view
      class="filter-tab {{currentType === 'invitation' ? 'active' : ''}}"
      bindtap="onSelectType"
      data-type="invitation"
    >çº¦çƒ</view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <scroll-view
    class="post-list"
    scroll-y
    bindscrolltolower="onLoadMore"
  >
    <view class="post-item" wx:for="{{posts}}" wx:key="id" bindtap="onTapPost" data-id="{{item.id}}">
      <view class="post-header">
        <image class="author-avatar" src="{{item.author_avatar || '/images/default-avatar.png'}}" mode="aspectFill" />
        <view class="author-info">
          <text class="author-name">{{item.author_name}}</text>
          <text class="post-meta">{{item.time_label}}</text>
        </view>
      </view>

      <text class="post-content">{{item.content}}</text>

      <!-- çº¦çƒå¡ç‰‡ -->
      <view class="match-box" wx:if="{{item.invitation}}" catchtap="onTapInvitation" data-id="{{item.invitation.id}}">
        <view class="match-title">ğŸ“ å‘èµ·çº¦çƒ</view>
        <view class="match-detail">
          <text wx:if="{{item.invitation.location}}">ğŸ“ {{item.invitation.location}}</text>
          <text wx:if="{{item.invitation.scheduled_time}}"> Â· ğŸ• {{item.invitation.time_label}}</text>
        </view>
      </view>

      <!-- å›¾ç‰‡ç½‘æ ¼ -->
      <view class="post-images {{item.images.length === 1 ? 'single' : (item.images.length <= 4 ? 'grid-2' : 'grid-3')}}" wx:if="{{item.images && item.images.length > 0}}">
        <image
          wx:for="{{item.images}}"
          wx:for-item="img"
          wx:key="*this"
          class="post-image"
          src="{{img}}"
          mode="aspectFill"
          catchtap="onPreviewImage"
          data-urls="{{item.images}}"
          data-current="{{img}}"
        />
      </view>

      <view class="post-actions">
        <view class="action-item {{item.is_liked ? 'liked' : ''}}">
          <text class="icon-heart">{{item.is_liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-count">{{item.like_count || 0}}</text>
        </view>
        <view class="action-item">
          <text class="icon-comment">ğŸ’¬</text>
          <text class="action-count">{{item.comment_count || 0}}</text>
        </view>
        <view class="action-item delete-btn" catchtap="onDelete" data-id="{{item.id}}" data-index="{{index}}">
          <text class="icon-delete">ğŸ—‘ï¸</text>
          <text class="action-count">åˆ é™¤</text>
        </view>
      </view>
    </view>

    <view class="load-more" wx:if="{{isLoading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view class="no-more" wx:if="{{noMore && posts.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
    <view class="empty" wx:if="{{!isLoading && posts.length === 0}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å‘å¸ƒè¿‡å†…å®¹</text>
    </view>
  </scroll-view>
</view>
