<view class="register-page">
  <!-- 头部 -->
  <view class="header">
    <view class="header-bg"></view>
    <view class="header-content">
      <text class="header-icon">🏓</text>
      <text class="header-title">{{isEditMode ? '编辑资料' : '完善个人信息'}}</text>
      <text class="header-desc">{{isEditMode ? '修改你的个人信息' : '请填写真实信息以便参与赛事'}}</text>
    </view>
  </view>

  <!-- 表单区域 -->
  <view class="form-section">
    <!-- 头像选择 -->
    <view class="avatar-section">
      <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
        <image class="avatar-img" src="{{form.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
        <view class="avatar-edit">
          <text class="avatar-edit-icon">📷</text>
        </view>
      </button>
      <text class="avatar-tip">点击选择微信头像</text>
    </view>

    <!-- 选择身份 -->
    <view class="form-label-title">选择身份</view>
    <view class="type-grid">
      <view
        wx:for="{{userTypes}}"
        wx:key="key"
        class="type-item {{selectedType === item.key ? 'selected' : ''}}"
        data-type="{{item.key}}"
        bindtap="selectType"
      >
        <text class="type-label">{{item.label}}</text>
      </view>
    </view>

    <!-- 基本信息 -->
    <view class="form-label-title">基本信息</view>

    <!-- 姓名 + 性别 -->
    <view class="form-row">
      <view class="form-group">
        <view class="form-label">姓名<text class="required">*</text></view>
        <input
          class="form-input"
          placeholder="请输入"
          value="{{form.name}}"
          data-field="name"
          bindinput="onInputChange"
        />
      </view>
      <view class="form-group">
        <view class="form-label">性别<text class="required">*</text></view>
        <custom-picker
          placeholder="请选择"
          options="{{genderOptions}}"
          value="{{form.gender}}"
          data-field="gender"
          bind:change="onPickerChange"
        />
      </view>
    </view>

    <!-- 手机号 -->
    <view class="form-group">
      <view class="form-label">手机号<text class="required">*</text></view>
      <input
        class="form-input"
        type="number"
        maxlength="11"
        placeholder="请输入手机号"
        value="{{form.phone}}"
        data-field="phone"
        bindinput="onInputChange"
      />
    </view>

    <!-- 学校 -->
    <view class="form-group">
      <view class="form-label">学校<text class="required">*</text></view>
      <custom-picker
        placeholder="请选择学校"
        options="{{schools}}"
        value="{{form.schoolId}}"
        data-field="schoolId"
        bind:change="onPickerChange"
      />
    </view>

    <!-- 学院（在校生/毕业生/老师） -->
    <view class="form-group" wx:if="{{selectedType !== 'staff'}}">
      <view class="form-label">学院<text class="required">*</text></view>
      <custom-picker
        placeholder="请选择学院"
        options="{{colleges}}"
        value="{{form.collegeId}}"
        disabled="{{!form.schoolId}}"
        data-field="collegeId"
        bind:change="onPickerChange"
      />
    </view>

    <!-- 下属单位（教职工） -->
    <view class="form-group" wx:if="{{selectedType === 'staff'}}">
      <view class="form-label">下属单位<text class="required">*</text></view>
      <custom-picker
        placeholder="请选择下属单位"
        options="{{departments}}"
        value="{{form.departmentId}}"
        disabled="{{!form.schoolId}}"
        data-field="departmentId"
        bind:change="onPickerChange"
      />
    </view>

    <!-- 班级 + 入学年份（在校生） -->
    <view class="form-row" wx:if="{{selectedType === 'student'}}">
      <view class="form-group">
        <view class="form-label">班级<text class="required">*</text></view>
        <input
          class="form-input"
          placeholder="如 计科2101"
          value="{{form.className}}"
          data-field="className"
          bindinput="onInputChange"
        />
      </view>
      <view class="form-group">
        <view class="form-label">入学年份<text class="required">*</text></view>
        <custom-picker
          placeholder="请选择"
          options="{{yearOptions}}"
          value="{{form.enrollmentYear}}"
          data-field="enrollmentYear"
          bind:change="onPickerChange"
        />
      </view>
    </view>

    <!-- 学院 + 入学年份（毕业生） -->
    <view class="form-row" wx:if="{{selectedType === 'graduate'}}">
      <view class="form-group">
        <view class="form-label">入学年份<text class="required">*</text></view>
        <custom-picker
          placeholder="请选择"
          options="{{yearOptions}}"
          value="{{form.enrollmentYear}}"
          data-field="enrollmentYear"
          bind:change="onPickerChange"
        />
      </view>
    </view>

    <!-- 提示信息 -->
    <view class="tip-box tip-yellow" wx:if="{{selectedType === 'graduate'}}">
      <text class="tip-icon">💡</text>
      <text class="tip-text">作为毕业生，你可以参与校友赛事和约球活动，与在校师生切磋交流。</text>
    </view>

    <view class="tip-box tip-blue" wx:if="{{selectedType === 'teacher'}}">
      <text class="tip-icon">📚</text>
      <text class="tip-text">作为老师，你可以申请成为长期赛事管理员，自主发起和管理赛事。</text>
    </view>

    <view class="tip-box tip-green" wx:if="{{selectedType === 'staff'}}">
      <text class="tip-icon">🏸</text>
      <text class="tip-text">欢迎加入乒乓球活动！你可以参与约球、签到打卡和各类赛事。</text>
    </view>

    <!-- 提交按钮 -->
    <button class="submit-btn" bindtap="onSubmit" disabled="{{submitting}}">
      {{submitting ? '提交中...' : (isEditMode ? '保存' : '提交')}}
    </button>
  </view>
</view>
